# 📋 Dev Docs 任务文档系统

> 用于管理长期任务和保持开发上下文的三文件系统

**创建日期**: 2025-11-05
**最后更新**: 2025-11-05
**维护者**: 开发团队

---

## 🎯 什么是 Dev Docs？

Dev Docs 是一个**任务级文档系统**，用于管理复杂的、跨多个会话的开发任务。它通过三个核心文件帮助 AI 助手和开发者保持任务上下文，防止在长期开发过程中迷失方向。

### 核心价值

- ✅ **防止迷失方向**：长期任务不会因为会话中断而失去上下文
- ✅ **保持一致性**：所有决策和关键信息都有记录
- ✅ **可追踪进度**：清晰的任务清单，随时了解完成情况
- ✅ **便于交接**：完整的上下文记录，方便团队协作
- ✅ **支持迭代**：每次会话都能快速恢复到上次的进度

---

## 📁 目录结构

```
docs/dev/
├── README.md              # 本文件（使用说明）
├── templates/             # 模板文件
│   ├── template-plan.md      # 计划模板
│   ├── template-context.md   # 上下文模板
│   └── template-tasks.md     # 任务清单模板
│
├── in-progress/           # 进行中的任务
│   └── [task-name]/
│       ├── plan.md           # 已批准的计划
│       ├── context.md        # 关键文件和决策
│       └── tasks.md          # 任务清单
│
└── completed/             # 已完成的任务（归档）
    └── [task-name]-2025-11-05/
        ├── plan.md
        ├── context.md
        └── tasks.md
```

---

## 🚀 何时使用 Dev Docs？

### ✅ 应该使用的场景

满足以下**任一条件**时，建议创建 Dev Docs：

1. **任务预计超过 4 小时** - 需要多次会话完成
2. **涉及多个模块/文件** - 修改范围广，容易遗漏
3. **需要经过多次迭代** - 反复调整和优化
4. **容易迷失方向** - 复杂的业务逻辑或技术实现
5. **需要团队协作** - 多人参与，需要共享上下文

**示例任务**：
- ✅ 开发完整的"星探推荐"功能
- ✅ 重构多角色登录系统
- ✅ 添加新的角色类型（内部星探）
- ✅ 优化数据库查询性能
- ✅ 实现完整的邀请码机制

### ❌ 不需要使用的场景

以下简单任务**不需要** Dev Docs：

- ❌ 修改一个按钮的样式
- ❌ 调整一个文案
- ❌ 修复一个简单的 bug（< 1小时）
- ❌ 添加一个简单的工具函数

---

## 📝 三文件系统详解

### 1️⃣ plan.md - 已批准的计划

**用途**：记录经过审批的完整开发计划

**包含内容**：
- 执行摘要（任务目标和预期结果）
- 分阶段计划（3-5个阶段）
- 每个阶段的任务清单
- 成功标准（如何判断完成）
- 风险评估
- 时间线

**何时创建**：
- 在**规划模式**完成后
- 用户批准计划后
- 开始实施之前

**示例结构**：
```markdown
# [任务名称] 开发计划

## 执行摘要
- 任务目标
- 预期结果
- 关键交付物

## 阶段 1: 数据模型设计
**目标**: 设计并实现数据结构
**任务**:
- [ ] 设计数据库表
- [ ] 创建数据模型
**成功标准**:
- 数据库表创建成功
- 数据关系正确

## 阶段 2: API 开发
...
```

---

### 2️⃣ context.md - 开发上下文

**用途**：记录关键决策、文件位置和技术细节

**包含内容**：
- 最后更新时间
- 关键文件列表（修改了哪些文件）
- 技术决策记录（为什么这样做）
- 依赖关系（依赖哪些模块）
- 遇到的问题和解决方案
- 下一步计划

**何时更新**：
- 完成一个阶段后
- 做了重要技术决策后
- 会话即将结束前（使用 `/update-dev-docs`）
- 遇到问题并解决后

**示例结构**：
```markdown
# [任务名称] - 开发上下文

## 最后更新
2025-11-05 14:30

## 关键文件
- `miniprogram/pages/scout/referral.js` - 推荐页面逻辑
- `cloudfunctions/verify-code/index.js` - 验证云函数
- `miniprogram/utils/scene-parser.js` - 场景参数解析

## 技术决策

### 为什么使用单独的推荐记录表？
- 需要追踪推荐历史
- 需要统计推荐成功率
- 便于后续佣金计算

### 为什么不复用候选人表？
- 推荐关系需要独立管理
- 佣金结算需要单独追踪

## 依赖关系
- 依赖现有的 `role-manager.js`
- 需要先完成用户认证升级

## 遇到的问题
1. **问题**：场景参数在 iOS 和 Android 解析不一致
   **解决**：使用 decodeURIComponent 统一处理

## 下一步
- [ ] 完成阶段 2 的 API 开发
- [ ] 测试推荐码验证逻辑
```

---

### 3️⃣ tasks.md - 任务清单

**用途**：可勾选的任务列表，追踪进度

**包含内容**：
- 按阶段组织的任务列表
- 每个任务的完成状态（勾选框）
- 任务优先级（可选）
- 任务负责人（团队协作时）

**何时更新**：
- **频繁更新** - 每完成一个任务立即勾选
- 不要等到一天结束才批量更新

**示例结构**：
```markdown
# 任务清单

## 阶段 1: 数据模型设计
- [x] 设计 ReferralCode 数据表结构
- [x] 创建推荐记录表 ReferralRecord
- [ ] 添加云数据库集合
- [ ] 编写数据库迁移脚本

## 阶段 2: 云函数开发
- [ ] 创建 verify-referral-code 云函数
- [ ] 实现推荐逻辑
- [ ] 添加错误处理
- [ ] 编写单元测试

## 阶段 3: 前端页面
- [ ] 创建推荐页面
- [ ] 实现推荐表单
- [ ] 连接云函数
```

---

## 🔄 完整工作流

### Step 1: 规划阶段

```bash
用户："plan: 开发星探推荐功能"
```

1. **进入规划模式**
2. **AI 助手研究代码库**，收集上下文
3. **创建详细计划**（执行摘要、分阶段、任务、风险）
4. **用户审查计划**，提出调整
5. **用户批准计划**

---

### Step 2: 创建 Dev Docs

```bash
# 批准后，AI 或用户手动创建 Dev Docs
mkdir -p docs/dev/in-progress/scout-referral-feature
```

AI 助手会创建三个文件：
- `plan.md` - 复制已批准的计划
- `context.md` - 记录关键文件和初始决策
- `tasks.md` - 从计划中提取任务清单

---

### Step 3: 实施阶段

#### 开始实施
```bash
用户："开始实施阶段 1"
```

AI 助手：
1. 读取 `plan.md`、`context.md`、`tasks.md`
2. 了解当前进度和上下文
3. 开始编码
4. **定期提醒更新 tasks.md**

#### 会话即将结束
```bash
用户："/update-dev-docs"
```

AI 助手：
1. 更新 `context.md`（添加新的决策、遇到的问题）
2. 更新 `tasks.md`（勾选完成的任务）
3. 添加"下一步"说明

```bash
用户："压缩对话"
```

---

### Step 4: 新会话继续

```bash
用户："继续开发星探推荐功能"
```

AI 助手：
1. 自动检测 `docs/dev/in-progress/` 下的任务
2. 读取三个文件了解上下文
3. 从上次的"下一步"继续
4. **无需重新解释需求**

---

### Step 5: 完成阶段

```bash
用户："星探推荐功能已经开发完成并测试通过"
```

AI 助手：
1. 确认所有 `tasks.md` 中的任务都已勾选
2. 移动 Dev Docs 到 `completed/`
3. 添加完成日期后缀
4. 更新相关的正式文档（如 PROJECT_KNOWLEDGE.md）

```bash
mv docs/dev/in-progress/scout-referral-feature \
   docs/dev/completed/scout-referral-feature-2025-11-05
```

---

## 💡 最佳实践

### ✅ Do's（应该做的）

1. **频繁更新 tasks.md**
   - ❌ 错误：一天结束时才批量更新
   - ✅ 正确：完成一个任务立即勾选

2. **context.md 记录"为什么"**
   - ❌ 错误：只记录"做了什么"
   - ✅ 正确：记录"为什么这样做"

3. **定期提醒 AI 更新**
   - 每完成一个阶段：`"更新 dev docs"`
   - 会话结束前：`"/update-dev-docs"`
   - 重要决策后：`"记录到 context.md"`

4. **利用 Dev Docs 做代码审查**
   ```
   用户："审查星探推荐功能，参考 dev docs 中的计划"

   AI：
   1. 读取 plan.md（了解原始计划）
   2. 对比实际代码
   3. 检查是否偏离计划
   4. 检查是否所有任务都已完成
   ```

5. **完成后归档**
   - 移动到 `completed/` 并添加日期
   - 作为未来类似任务的参考

---

### ❌ Don'ts（不应该做的）

1. **不要忘记更新**
   - 长时间不更新会导致信息过时
   - AI 下次恢复时会困惑

2. **不要过度详细**
   - context.md 不是代码注释
   - 只记录关键决策和上下文

3. **不要在简单任务上使用**
   - 修个小 bug 不需要 Dev Docs
   - 会增加不必要的负担

4. **不要忘记清理**
   - 完成的任务要移到 `completed/`
   - 避免 `in-progress/` 堆积过多

---

## 🛠️ 使用模板

### 创建新任务

1. **复制模板**
   ```bash
   cp -r docs/dev/templates docs/dev/in-progress/my-new-task
   cd docs/dev/in-progress/my-new-task

   # 重命名模板文件
   mv template-plan.md plan.md
   mv template-context.md context.md
   mv template-tasks.md tasks.md
   ```

2. **填写内容**
   - 在 `plan.md` 中填写计划
   - 在 `context.md` 中记录初始上下文
   - 在 `tasks.md` 中列出任务

3. **开始开发**

---

## 📚 示例：完整的 Dev Docs

查看 `docs/dev/completed/` 下的已完成任务，了解完整的 Dev Docs 示例。

---

## 🤝 团队协作

Dev Docs 也适用于团队协作：

1. **任务交接**
   ```
   开发者 A 完成阶段 1 后：
   - 更新 context.md 和 tasks.md
   - 提交到 Git

   开发者 B 接手：
   - 读取三个文件了解上下文
   - 从"下一步"继续
   ```

2. **代码审查**
   ```
   审查者：
   - 对比 plan.md 和实际实现
   - 检查是否所有 tasks.md 都完成
   - 查看 context.md 了解决策背景
   ```

3. **知识传承**
   ```
   新成员：
   - 查看 completed/ 下的类似任务
   - 了解团队的开发模式
   - 学习决策过程
   ```

---

## 📞 获取帮助

- **使用问题**：查看本文档
- **模板问题**：查看 `templates/` 目录
- **示例参考**：查看 `completed/` 目录

---

**最后更新**: 2025-11-05
**维护者**: 开发团队

> 💡 提示：Dev Docs 是保持长期任务上下文的最佳实践。善用它可以大幅提高开发效率，尤其是在使用 AI 助手时。
