# ðŸŽ­ å¤šè§’è‰²ç³»ç»Ÿè®¾è®¡

> åŸºäºŽå¾®ä¿¡å°ç¨‹åºçš„å¤šè§’è‰²ç™»å½•å’Œå·¥ä½œå°è®¾è®¡æ–¹æ¡ˆ

**åˆ›å»ºæ—¥æœŸ**: 2025-11-02
**æœ€åŽæ›´æ–°**: 2025-11-02
**ç»´æŠ¤è€…**: äº§å“å›¢é˜Ÿ
**çŠ¶æ€**: å·²å‘å¸ƒ

---

## ðŸ“‘ ç›®å½•

- [ç³»ç»Ÿæ¦‚è¿°](#ç³»ç»Ÿæ¦‚è¿°)
- [ç”¨æˆ·è§’è‰²åˆ†ç±»](#ç”¨æˆ·è§’è‰²åˆ†ç±»)
- [ç™»å½•å’Œè§’è‰²è¯†åˆ«æµç¨‹](#ç™»å½•å’Œè§’è‰²è¯†åˆ«æµç¨‹)
- [ç”¨æˆ·æœªæ³¨å†Œå¤„ç†æ–¹æ¡ˆ](#ç”¨æˆ·æœªæ³¨å†Œå¤„ç†æ–¹æ¡ˆ)
- [å°ç¨‹åºé¡µé¢æž¶æž„](#å°ç¨‹åºé¡µé¢æž¶æž„)
- [å„è§’è‰²å·¥ä½œå°è®¾è®¡](#å„è§’è‰²å·¥ä½œå°è®¾è®¡)
- [é‚€è¯·ç å’ŒæŽ¨èç æœºåˆ¶](#é‚€è¯·ç å’ŒæŽ¨èç æœºåˆ¶)
- [å®‰å…¨é˜²æŠ¤æœºåˆ¶](#å®‰å…¨é˜²æŠ¤æœºåˆ¶)

---

## ç³»ç»Ÿæ¦‚è¿°

### è®¾è®¡ç›®æ ‡

æœ¬ç³»ç»Ÿé€šè¿‡å¾®ä¿¡å°ç¨‹åºå®žçŽ°å¤šè§’è‰²ç»Ÿä¸€å…¥å£ï¼Œæ ¹æ®ç”¨æˆ·èº«ä»½è‡ªåŠ¨åŒ¹é…ç›¸åº”çš„å·¥ä½œç•Œé¢ï¼Œæ”¯æŒä»¥ä¸‹æ ¸å¿ƒåœºæ™¯ï¼š

1. âœ… **ä¸»æ’­æ‹›è˜æµç¨‹**ï¼šå€™é€‰äººæŠ•é€’ç®€åŽ† â†’ åœ¨çº¿é¢è¯• â†’ æŸ¥çœ‹ç»“æžœ
2. âœ… **ä¸»æ’­å·¥ä½œç®¡ç†**ï¼šå·²å…¥èŒä¸»æ’­çš„æ—¥å¸¸å·¥ä½œå°
3. âœ… **å‘˜å·¥ååŒåŠžå…¬**ï¼š9ç§å†…éƒ¨å‘˜å·¥è§’è‰²çš„ä¸“å±žå·¥ä½œå°
4. âœ… **å¤–éƒ¨æ˜ŸæŽ¢æŽ¨è**ï¼šå¤–éƒ¨åˆä½œæ˜ŸæŽ¢æŽ¨èä¸»æ’­å¹¶èŽ·å¾—ä½£é‡‘

### æ ¸å¿ƒç‰¹æ€§

- ðŸ” **å¾®ä¿¡å…ç™»å½•**ï¼šåˆ©ç”¨å¾®ä¿¡æŽˆæƒï¼Œæ— éœ€è´¦å·å¯†ç 
- ðŸŽ¯ **æ™ºèƒ½è·¯ç”±**ï¼šæ ¹æ®è§’è‰²è‡ªåŠ¨è·³è½¬å¯¹åº”å·¥ä½œå°
- ðŸ”— **åœºæ™¯ç è¯†åˆ«**ï¼šæ”¯æŒæŽ¨èç ã€é‚€è¯·ç ç­‰å¤šç§è¿›å…¥æ–¹å¼
- ðŸ›¡ï¸ **å®‰å…¨å¯æŽ§**ï¼šé‚€è¯·ç æœºåˆ¶é˜²æ­¢éšæ„æ³¨å†Œ
- ðŸ“± **å¤šç«¯ç»Ÿä¸€**ï¼šä¸€ä¸ªå°ç¨‹åºæ»¡è¶³æ‰€æœ‰è§’è‰²éœ€æ±‚

---

## ç”¨æˆ·è§’è‰²åˆ†ç±»

### å››å¤§ç”¨æˆ·ç±»åž‹

```mermaid
graph TD
    A[ç³»ç»Ÿç”¨æˆ·] --> B[ä¸»æ’­å€™é€‰äºº]
    A --> C[ä¸»æ’­]
    A --> D[å†…éƒ¨å‘˜å·¥]
    A --> E[å¤–éƒ¨æ˜ŸæŽ¢]

    D --> D1[HRç®¡ç†å‘˜]
    D --> D2[ç»çºªäºº]
    D --> D3[è¿è¥ä¸“å‘˜]
    D --> D4[èˆžè¹ˆåŸ¹è®­å¸ˆ]
    D --> D5[åŒ–å¦†å¸ˆ]
    D --> D6[æ­é…å¸ˆ]
    D --> D7[ä¸“èŒæ˜ŸæŽ¢]
    D --> D8[è´¢åŠ¡ä¸“å‘˜]
    D --> D9[æ‘„åƒå¸ˆ]

    style B fill:#e1f5ff
    style C fill:#fff4e6
    style D fill:#f3e5f5
    style E fill:#e8f5e9
```

### è§’è‰²è¯¦ç»†è¯´æ˜Ž

#### 1ï¸âƒ£ ä¸»æ’­å€™é€‰äººï¼ˆCandidateï¼‰

**å®šä¹‰**ï¼šå·²æäº¤æŠ¥åä½†å°šæœªç­¾çº¦çš„åº”è˜è€…ï¼ˆ**ä¹Ÿæ˜¯ç³»ç»Ÿç”¨æˆ·**ï¼‰

**é‡è¦è¯´æ˜Ž**ï¼š
- âœ… **å€™é€‰äººæŠ¥åæ—¶å°±åˆ›å»ºå¾®ä¿¡è´¦å·**ï¼ˆrole=candidateï¼‰
- âœ… æ‹¥æœ‰ç‹¬ç«‹çš„å€™é€‰äººå·¥ä½œå°
- âœ… å¯ä»¥æŸ¥çœ‹å®¡æ ¸è¿›åº¦ã€æŽ¥æ”¶é¢è¯•é€šçŸ¥
- âœ… ç­¾çº¦åŽè§’è‰²è‡ªåŠ¨å‡çº§ä¸ºä¸»æ’­ï¼ˆcandidate â†’ streamerï¼‰

**ä¸»è¦åŠŸèƒ½**ï¼š
- å¡«å†™å’Œæäº¤æŠ¥åè¡¨
- æŸ¥çœ‹å®¡æ ¸çŠ¶æ€ï¼ˆå®žæ—¶ï¼‰
- æŽ¥æ”¶é¢è¯•é€šçŸ¥ï¼ˆå°ç¨‹åºæ¶ˆæ¯æŽ¨é€ï¼‰
- å‚åŠ åœ¨çº¿é¢è¯•
- æŸ¥çœ‹é¢è¯•ç»“æžœ
- æŸ¥çœ‹å½•ç”¨é€šçŸ¥
- è”ç³»HR

**çŠ¶æ€æµè½¬**ï¼š
```
æ‰«ç /æœç´¢å°ç¨‹åº
    â†“
å¾®ä¿¡ç™»å½• + å¡«å†™æŠ¥åè¡¨
    â†“
åˆ›å»ºè´¦å·ï¼ˆrole=candidateï¼‰
    â†“
çŠ¶æ€ï¼špending â†’ reviewing â†’ interviewed â†’ offered â†’ signed
    â†“
ç­¾çº¦åŽï¼šroleå‡çº§ä¸ºstreamer
```

---

#### 2ï¸âƒ£ ä¸»æ’­ï¼ˆStreamerï¼‰

**å®šä¹‰**ï¼šå·²ç­¾çº¦å…¥èŒçš„æ­£å¼ä¸»æ’­

**ä¸»è¦åŠŸèƒ½**ï¼š
- æŸ¥çœ‹æœ¬å‘¨æŽ’ç­
- æŸ¥çœ‹åŸ¹è®­ä»»åŠ¡
- æäº¤ç»ƒä¹ è§†é¢‘
- æŸ¥çœ‹ç›´æ’­æ•°æ®
- æŸ¥çœ‹æ”¶ç›Šæ˜Žç»†
- æŸ¥çœ‹å‘¨æŠ¥åé¦ˆ

**æƒé™èŒƒå›´**ï¼šåªèƒ½æŸ¥çœ‹è‡ªå·±çš„æ•°æ®

---

#### 3ï¸âƒ£ å†…éƒ¨å‘˜å·¥ï¼ˆEmployeeï¼‰

**9ç§è§’è‰²ç±»åž‹**ï¼š

| è§’è‰² | ä»£ç  | ä¸»è¦å·¥ä½œ |
|------|------|---------|
| HRç®¡ç†å‘˜ | `hr_admin` | å€™é€‰äººç®¡ç†ã€é¢è¯•å®‰æŽ’ã€åˆåŒç­¾ç½² |
| ç»çºªäºº | `agent` | å›¢é˜Ÿç®¡ç†ã€æŽ’ç­ç¡®è®¤ã€å‘¨æŠ¥å¤ç›˜ |
| è¿è¥ä¸“å‘˜ | `operator` | æŽ’ç­ç®¡ç†ã€å®žæ—¶ç›‘æŽ§ã€æ•°æ®åˆ†æž |
| èˆžè¹ˆåŸ¹è®­å¸ˆ | `dance_teacher` | èˆžè¹ˆè®­ç»ƒã€è¿›åº¦è·Ÿè¸ªã€è€ƒæ ¸è¯„ä¼° |
| åŒ–å¦†å¸ˆ | `makeup_artist` | å¦†å®¹è®¾è®¡ã€å½¢è±¡æŒ‡å¯¼ã€æ•ˆæžœåˆ†æž |
| æ­é…å¸ˆ | `stylist` | é€ åž‹è®¾è®¡ã€æœè£…æ­é…ã€é£Žæ ¼å¡‘é€  |
| ä¸“èŒæ˜ŸæŽ¢ | `scout_internal` | ä¸»æ’­æ‹›å‹Ÿã€å€™é€‰äººç­›é€‰ |
| è´¢åŠ¡ä¸“å‘˜ | `finance` | æ”¶ç›Šç»“ç®—ã€è´¢åŠ¡å®¡æ ¸ã€å‘æ”¾ç®¡ç† |
| æ‘„åƒå¸ˆ | `videographer` | é¢è¯•å½•åˆ¶ã€ç´ æä¸Šä¼ ã€è§†é¢‘ç®¡ç† |

**æƒé™ç‰¹ç‚¹**ï¼š
- ðŸ”’ æ•°æ®è®¿é—®å—é™ï¼ˆåªèƒ½çœ‹æƒé™èŒƒå›´å†…çš„æ•°æ®ï¼‰
- ðŸŽ¯ åŠŸèƒ½æ¨¡å—å®šåˆ¶ï¼ˆæ¯ä¸ªè§’è‰²çœ‹åˆ°çš„é¡µé¢ä¸åŒï¼‰
- ðŸ‘¥ éœ€è¦é‚€è¯·ç æ‰èƒ½æ³¨å†Œï¼ˆé˜²æ­¢éšæ„æ³¨å†Œï¼‰

---

#### 4ï¸âƒ£ å¤–éƒ¨æ˜ŸæŽ¢ï¼ˆExternal Scoutï¼‰

**å®šä¹‰**ï¼šä¸Žå…¬å¸ç­¾çº¦çš„å¤–éƒ¨åˆä½œæŽ¨èäºº

**ä¸»è¦åŠŸèƒ½**ï¼š
- ç”Ÿæˆä¸“å±žæŽ¨èç 
- åˆ†äº«æŽ¨èé“¾æŽ¥/äºŒç»´ç 
- æŸ¥çœ‹æŽ¨èè®°å½•
- æŸ¥çœ‹ä½£é‡‘æ˜Žç»†
- æçŽ°ç”³è¯·

**ä½£é‡‘æœºåˆ¶**ï¼š
- æŽ¨èä¸»æ’­å…¥èŒ â†’ èŽ·å¾—ç­¾çº¦å¥–é‡‘
- ä¸»æ’­æŒç»­ç›´æ’­ â†’ èŽ·å¾—æŒç»­ä½£é‡‘ï¼ˆå¦‚å‰3ä¸ªæœˆæ”¶ç›Šçš„5%ï¼‰

---

## ç™»å½•å’Œè§’è‰²è¯†åˆ«æµç¨‹

### å®Œæ•´æµç¨‹å›¾

```mermaid
graph TD
    A[ç”¨æˆ·æ‰“å¼€å°ç¨‹åº] --> B{æ˜¯å¦å·²æŽˆæƒå¾®ä¿¡}

    B -->|å¦| C[è¯·æ±‚å¾®ä¿¡æŽˆæƒ]
    C --> D[ç”¨æˆ·åŒæ„æŽˆæƒ]
    D --> E[èŽ·å–ç”¨æˆ·ä¿¡æ¯]

    B -->|æ˜¯| F[é™é»˜ç™»å½•]
    F --> E

    E --> G[è°ƒç”¨åŽç«¯ç™»å½•æŽ¥å£]
    G --> H[ä¼ é€’: openid + åœºæ™¯å‚æ•°]

    H --> I{æ•°æ®åº“æŸ¥è¯¢ç”¨æˆ·}

    I -->|å·²æ³¨å†Œ| J[è¯»å–ç”¨æˆ·è§’è‰²]
    J --> K{è§’è‰²ç±»åž‹åˆ¤æ–­}

    K -->|candidate| L1[å€™é€‰äººå·¥ä½œå°]
    K -->|streamer| L2[ä¸»æ’­å·¥ä½œå°]
    K -->|employee| L3[å‘˜å·¥å·¥ä½œå°]
    K -->|scout_external| L4[æ˜ŸæŽ¢å·¥ä½œå°]

    I -->|æœªæ³¨å†Œ| M[è¿›å…¥æ³¨å†Œæµç¨‹]
    M --> N[è¯¦è§ä¸‹æ–¹æœªæ³¨å†Œå¤„ç†æ–¹æ¡ˆ]

    style I fill:#ffe082
    style M fill:#ffab91
```

### æŠ€æœ¯å®žçŽ°è¦ç‚¹

#### 1. å¾®ä¿¡æŽˆæƒç™»å½•

**é¦–æ¬¡ç™»å½•**ï¼š
```javascript
// app.js - å°ç¨‹åºå¯åŠ¨
onLaunch(options) {
  // èŽ·å–åœºæ™¯å‚æ•°
  this.globalData.sceneParams = {
    scene: options.scene,
    query: options.query,
    referrerInfo: options.referrerInfo
  };

  // æ£€æŸ¥æ˜¯å¦æŽˆæƒ
  wx.getSetting({
    success: (res) => {
      if (res.authSetting['scope.userInfo']) {
        // å·²æŽˆæƒï¼Œé™é»˜ç™»å½•
        this.silentLogin();
      } else {
        // æœªæŽˆæƒï¼Œè·³è½¬æŽˆæƒé¡µ
        wx.navigateTo({
          url: '/pages/auth/login/login'
        });
      }
    }
  });
}
```

**é™é»˜ç™»å½•**ï¼š
```javascript
// å·²æŽˆæƒæƒ…å†µä¸‹çš„é™é»˜ç™»å½•
silentLogin() {
  wx.cloud.callFunction({
    name: 'login',
    data: {
      sceneParams: this.globalData.sceneParams
    }
  }).then(res => {
    if (res.result.registered) {
      // å·²æ³¨å†Œï¼Œè·³è½¬å¯¹åº”å·¥ä½œå°
      this.routeToWorkspace(res.result.userRole);
    } else {
      // æœªæ³¨å†Œï¼Œè¿›å…¥æ³¨å†Œæµç¨‹
      this.handleUnregistered(res.result);
    }
  });
}
```

#### 2. è§’è‰²è¯†åˆ«é€»è¾‘

**åŽç«¯äº‘å‡½æ•°**ï¼š
```javascript
// cloudfunctions/login/index.js
exports.main = async (event, context) => {
  const { OPENID } = cloud.getWXContext();
  const { sceneParams } = event;

  // 1. æŸ¥è¯¢ç”¨æˆ·æ˜¯å¦å·²æ³¨å†Œ
  const userRecord = await db.collection('users')
    .where({ openid: OPENID })
    .get();

  if (userRecord.data.length > 0) {
    // å·²æ³¨å†Œï¼Œè¿”å›žè§’è‰²ä¿¡æ¯
    const user = userRecord.data[0];
    return {
      registered: true,
      userId: user._id,
      userRole: user.role_type,
      roleData: await getRoleData(user.role_type, user.role_id)
    };
  } else {
    // æœªæ³¨å†Œï¼Œè¿”å›žåœºæ™¯å‚æ•°ç”¨äºŽæ³¨å†Œ
    return {
      registered: false,
      openid: OPENID,
      sceneParams: sceneParams
    };
  }
};
```

#### 3. è‡ªåŠ¨è·¯ç”±è·³è½¬

**æ ¹æ®è§’è‰²è·³è½¬**ï¼š
```javascript
// app.js
routeToWorkspace(roleType) {
  const routeMap = {
    'candidate': '/pages/candidate/home/home',
    'streamer': '/pages/streamer/home/home',
    'hr_admin': '/pages/employee/hr/home/home',
    'agent': '/pages/employee/agent/home/home',
    'operator': '/pages/employee/operator/home/home',
    'dance_teacher': '/pages/employee/teacher/home/home',
    'makeup_artist': '/pages/employee/teacher/home/home',
    'stylist': '/pages/employee/teacher/home/home',
    'finance': '/pages/employee/finance/home/home',
    'scout_external': '/pages/scout-external/home/home'
  };

  const targetPage = routeMap[roleType] || '/pages/auth/role-select/role-select';

  wx.reLaunch({ url: targetPage });
}
```

---

## ç”¨æˆ·æœªæ³¨å†Œå¤„ç†æ–¹æ¡ˆ

### å†³ç­–æ ‘

```mermaid
graph TD
    A[ç”¨æˆ·æœªæ³¨å†Œ] --> B{æ£€æŸ¥å°ç¨‹åºå¯åŠ¨å‚æ•°}

    B -->|æœ‰æ˜ŸæŽ¢æŽ¨èç | C[åœºæ™¯1: æ˜ŸæŽ¢æŽ¨è]
    C --> C1[éªŒè¯æŽ¨èç æœ‰æ•ˆæ€§]
    C1 -->|æœ‰æ•ˆ| C2[è‡ªåŠ¨æ³¨å†Œä¸ºå€™é€‰äºº]
    C2 --> C3[è®°å½•æŽ¨èå…³ç³»]
    C3 --> C4[è·³è½¬ä¸»æ’­æŠ¥åé¡µ]
    C1 -->|æ— æ•ˆ| C5[æç¤ºé”™è¯¯]

    B -->|æœ‰å‘˜å·¥é‚€è¯·ç | D[åœºæ™¯2: å‘˜å·¥é‚€è¯·]
    D --> D1[éªŒè¯é‚€è¯·ç ]
    D1 -->|æœ‰æ•ˆ| D2[è·³è½¬å‘˜å·¥ä¿¡æ¯ç»‘å®šé¡µ]
    D2 --> D3[è¾“å…¥æ‰‹æœºå·éªŒè¯]
    D3 --> D4[ç»‘å®šopenidåˆ°å‘˜å·¥è´¦å·]
    D4 --> D5[è·³è½¬å‘˜å·¥å·¥ä½œå°]
    D1 -->|æ— æ•ˆ| D6[æç¤ºé”™è¯¯]

    B -->|æ— å‚æ•°| E[åœºæ™¯3: ç›´æŽ¥æ‰“å¼€]
    E --> E1[æ˜¾ç¤ºèº«ä»½é€‰æ‹©é¡µ]
    E1 --> E2{ç”¨æˆ·é€‰æ‹©}
    E2 -->|åº”è˜ä¸»æ’­| E3[è·³è½¬ä¸»æ’­æŠ¥åé¡µ]
    E2 -->|æˆ‘æ˜¯æ˜ŸæŽ¢| E4[è·³è½¬æ˜ŸæŽ¢æ³¨å†Œé¡µ]
    E2 -->|æˆ‘æ˜¯å‘˜å·¥| E5[æç¤ºéœ€è¦é‚€è¯·ç ]

    style C fill:#c8e6c9
    style D fill:#bbdefb
    style E fill:#fff9c4
```

---

### åœºæ™¯1ï¼šé€šè¿‡æ˜ŸæŽ¢æŽ¨èç è¿›å…¥ â­

#### è§¦å‘æ–¹å¼

ç”¨æˆ·æ‰«ææ˜ŸæŽ¢åˆ†äº«çš„äºŒç»´ç æˆ–ç‚¹å‡»åˆ†äº«é“¾æŽ¥è¿›å…¥å°ç¨‹åºã€‚

#### å°ç¨‹åºå¯åŠ¨å‚æ•°

```javascript
// åœºæ™¯å€¼ç¤ºä¾‹
{
  scene: 1047, // æ‰«æå°ç¨‹åºç 
  query: {
    scout_code: 'SC-EXT-20250102-A3B9' // æ˜ŸæŽ¢æŽ¨èç 
  }
}
```

#### å¤„ç†æµç¨‹

```mermaid
sequenceDiagram
    participant U as å€™é€‰äºº
    participant MP as å°ç¨‹åº
    participant CF as äº‘å‡½æ•°
    participant DB as æ•°æ®åº“

    U->>MP: æ‰«ææ˜ŸæŽ¢æŽ¨èç 
    MP->>MP: å¾®ä¿¡é™é»˜ç™»å½•èŽ·å–openId
    MP->>CF: è°ƒç”¨ checkUser(openId)
    CF->>DB: æŸ¥è¯¢ç”¨æˆ· (openid)

    alt å·²æ³¨å†Œ
        DB-->>CF: è¿”å›žç”¨æˆ·ä¿¡æ¯
        CF-->>MP: ç”¨æˆ·å·²å­˜åœ¨
        MP->>U: è·³è½¬å€™é€‰äººå·¥ä½œå°ï¼ˆå·²æŠ¥åï¼‰
    else æœªæ³¨å†Œ
        DB-->>CF: ç”¨æˆ·ä¸å­˜åœ¨
        CF-->>MP: æ–°ç”¨æˆ·
        MP->>U: è·³è½¬æŠ¥åé¡µï¼ˆURLå¸¦æŽ¨èç ï¼‰
        U->>MP: å¡«å†™æŠ¥åè¡¨
        MP->>CF: æäº¤æŠ¥åï¼ˆå«æŽ¨èç ï¼‰
        CF->>DB: éªŒè¯æŽ¨èç æœ‰æ•ˆæ€§
        CF->>DB: åˆ›å»ºç”¨æˆ·è´¦å·ï¼ˆrole=candidateï¼‰
        CF->>DB: è®°å½•æŽ¨èå…³ç³»
        DB-->>CF: åˆ›å»ºæˆåŠŸ
        CF-->>MP: è¿”å›žç”¨æˆ·ä¿¡æ¯
        MP->>U: è·³è½¬å€™é€‰äººå·¥ä½œå°
    end
```

#### å…³é”®ä»£ç å®žçŽ°

**1. å°ç¨‹åºç«¯å¤„ç†**
```javascript
// pages/auth/login.js
Page({
  async onLoad(options) {
    const { scout_code } = options;

    // 1. å¾®ä¿¡é™é»˜ç™»å½•
    const loginRes = await wx.cloud.callFunction({
      name: 'login'
    });
    const { openId } = loginRes.result;

    // 2. æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²æ³¨å†Œ
    const checkRes = await wx.cloud.callFunction({
      name: 'checkUser',
      data: { openId }
    });

    if (checkRes.result.exists) {
      // å·²æ³¨å†Œï¼Œç›´æŽ¥è·³è½¬å·¥ä½œå°
      const user = checkRes.result.user;
      this.routeToWorkspace(user.role);
    } else {
      // æœªæ³¨å†Œï¼Œè·³è½¬æŠ¥åé¡µ
      wx.navigateTo({
        url: `/pages/candidate/apply/apply?scout_code=${scout_code || ''}`
      });
    }
  }
});
```

**2. æŠ¥åé¡µå¤„ç†**
```javascript
// pages/candidate/apply/apply.js
Page({
  data: {
    scoutCode: '',
    formData: { /* æŠ¥åä¿¡æ¯ */ }
  },

  onLoad(options) {
    // èŽ·å–æŽ¨èç 
    this.setData({
      scoutCode: options.scout_code || ''
    });

    // å¦‚æžœæœ‰æŽ¨èç ï¼Œæ˜¾ç¤ºæŽ¨èäººä¿¡æ¯
    if (options.scout_code) {
      this.loadScoutInfo(options.scout_code);
    }
  },

  // æäº¤æŠ¥å
  async submitApplication() {
    const result = await wx.cloud.callFunction({
      name: 'createCandidate',
      data: {
        ...this.data.formData,
        scoutCode: this.data.scoutCode
      }
    });

    if (result.result.success) {
      // æäº¤æˆåŠŸï¼Œè·³è½¬å·¥ä½œå°
      wx.reLaunch({
        url: '/pages/candidate/home/home'
      });
    }
  }
});
```

**3. äº‘å‡½æ•°åˆ›å»ºè´¦å·**
```javascript
// cloudfunctions/createCandidate/index.js
exports.main = async (event, context) => {
  const { OPENID } = cloud.getWXContext();
  const { formData, scoutCode } = event;

  // 1. éªŒè¯æŽ¨èç ï¼ˆå¦‚æžœæœ‰ï¼‰
  let scoutInfo = null;
  if (scoutCode) {
    const scout = await db.collection('scouts')
      .where({ code: scoutCode, status: 'active' })
      .get();

    if (scout.data.length === 0) {
      throw new Error('æŽ¨èç æ— æ•ˆæˆ–å·²å¤±æ•ˆ');
    }
    scoutInfo = scout.data[0];
  }

  // 2. åˆ›å»ºç”¨æˆ·è´¦å·ï¼ˆrole=candidateï¼‰
  const userId = await db.collection('users').add({
    data: {
      openId: OPENID,
      userType: 'candidate',
      role: 'candidate',

      candidateInfo: {
        status: 'pending', // å¾…å®¡æ ¸
        source: scoutCode ? 'scout_referral' : 'self_apply',
        applyData: formData,
        applyAt: new Date()
      },

      accountStatus: {
        isActivated: true,
        isFirstLogin: false, // æŠ¥åå³å®Œæˆé¦–æ¬¡ä½¿ç”¨
        isProfileComplete: true
      },

      profile: {
        name: formData.basicInfo.name,
        phone: formData.basicInfo.phone
      },

      createdAt: new Date()
    }
  });

  // 3. è®°å½•æŽ¨èå…³ç³»ï¼ˆå¦‚æžœæœ‰ï¼‰
  if (scoutInfo) {
    await db.collection('referral_records').add({
      data: {
        userId: userId._id,
        scoutId: scoutInfo._id,
        scoutCode: scoutCode,
        referredAt: new Date(),
        status: 'pending', // å¾…è½¬åŒ–
        commissionRate: 0.05
      }
    });
  }

  return { success: true, userId: userId._id };
};
```

#### ç”¨æˆ·ä½“éªŒæµç¨‹

```
ç”¨æˆ·æ‰«ææŽ¨èç 
    â†“
è‡ªåŠ¨å¾®ä¿¡ç™»å½•ï¼ˆæ— æ„ŸçŸ¥ï¼‰
    â†“
ã€å·²æŠ¥åç”¨æˆ·ã€‘ â†’ ç›´æŽ¥è¿›å…¥å€™é€‰äººå·¥ä½œå°
ã€æ–°ç”¨æˆ·ã€‘ â†’ è¿›å…¥æŠ¥åé¡µ
    â†“
æ˜¾ç¤ºæŽ¨èäººä¿¡æ¯ï¼ˆå¦‚ï¼šæ˜ŸæŽ¢å¼ ä¸‰æŽ¨èï¼‰
    â†“
å¡«å†™æŠ¥åè¡¨
    â†“
æäº¤ â†’ åˆ›å»ºè´¦å·ï¼ˆrole=candidateï¼‰
    â†“
è·³è½¬å€™é€‰äººå·¥ä½œå°
```

---

### åœºæ™¯2ï¼šé€šè¿‡å‘˜å·¥é‚€è¯·ç è¿›å…¥ ðŸ‘”

#### è§¦å‘æ–¹å¼

HRå‘é€ç»™æ–°å‘˜å·¥çš„ä¸“å±žé‚€è¯·é“¾æŽ¥ã€‚

#### å°ç¨‹åºå¯åŠ¨å‚æ•°

```javascript
// åœºæ™¯å€¼ç¤ºä¾‹
{
  scene: 1011, // æ‰«æå°ç¨‹åºç 
  query: {
    invite_code: 'INV-HR-20250102-X7Y9' // å‘˜å·¥é‚€è¯·ç 
  }
}
```

#### é‚€è¯·ç ç”Ÿæˆï¼ˆHRåŽå°åŠŸèƒ½ï¼‰

```javascript
// äº‘å‡½æ•°ï¼šHRç”Ÿæˆé‚€è¯·ç 
exports.main = async (event, context) => {
  const { roleType, employeeName } = event;

  // 1. éªŒè¯è°ƒç”¨è€…æƒé™
  const caller = await getCurrentUser(context.OPENID);
  if (!['hr_admin', 'super_admin'].includes(caller.role_type)) {
    throw new Error('æ— æƒé™ç”Ÿæˆé‚€è¯·ç ');
  }

  // 2. ç”Ÿæˆå”¯ä¸€é‚€è¯·ç 
  const timestamp = Date.now().toString(36);
  const random = Math.random().toString(36).substring(2, 6).toUpperCase();
  const inviteCode = `INV-${roleType.split('_')[0].toUpperCase()}-${timestamp}-${random}`;

  // 3. ä¿å­˜åˆ°æ•°æ®åº“
  await db.collection('invite_codes').add({
    data: {
      code: inviteCode,
      role_type: roleType,
      employee_name: employeeName,
      created_by: caller.user_id,
      created_at: new Date(),
      expires_at: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000), // 7å¤©æœ‰æ•ˆæœŸ
      used: false,
      used_by: null,
      used_at: null
    }
  });

  // 4. ç”Ÿæˆå°ç¨‹åºç 
  const qrCodeBuffer = await cloud.openapi.wxacode.getUnlimited({
    scene: `invite_code=${inviteCode}`,
    page: 'pages/auth/login/login'
  });

  return {
    inviteCode,
    qrCode: qrCodeBuffer.buffer
  };
};
```

#### å¤„ç†æµç¨‹

```mermaid
sequenceDiagram
    participant U as æ–°å‘˜å·¥
    participant MP as å°ç¨‹åº
    participant CF as äº‘å‡½æ•°
    participant DB as æ•°æ®åº“

    U->>MP: æ‰«æé‚€è¯·ç 
    MP->>CF: è°ƒç”¨ login (å¸¦é‚€è¯·ç )
    CF->>DB: æŸ¥è¯¢ç”¨æˆ· (openid)
    DB-->>CF: æœªæ³¨å†Œ
    CF->>DB: éªŒè¯é‚€è¯·ç 
    DB-->>CF: é‚€è¯·ç æœ‰æ•ˆ
    CF-->>MP: è¿”å›žè§’è‰²ä¿¡æ¯
    MP->>U: æ˜¾ç¤ºä¿¡æ¯ç»‘å®šé¡µ
    U->>MP: è¾“å…¥æ‰‹æœºå·+å§“å
    MP->>CF: æäº¤ç»‘å®šä¿¡æ¯
    CF->>DB: éªŒè¯æ‰‹æœºå·æ˜¯å¦å­˜åœ¨
    DB-->>CF: æ‰‹æœºå·å·²é¢„ç™»è®°
    CF->>DB: ç»‘å®š openid åˆ°å‘˜å·¥è®°å½•
    CF->>DB: æ ‡è®°é‚€è¯·ç å·²ä½¿ç”¨
    DB-->>CF: ç»‘å®šæˆåŠŸ
    CF-->>MP: è¿”å›žå‘˜å·¥ä¿¡æ¯
    MP->>U: è·³è½¬å‘˜å·¥å·¥ä½œå°
```

#### å‘˜å·¥ä¿¡æ¯ç»‘å®šé¡µé¢

**é¡µé¢å…ƒç´ **ï¼š
- ðŸ“± æ‰‹æœºå·è¾“å…¥æ¡†ï¼ˆå¿…å¡«ï¼‰
- ðŸ‘¤ çœŸå®žå§“åè¾“å…¥æ¡†ï¼ˆå¿…å¡«ï¼‰
- âœ… éªŒè¯ç è¾“å…¥æ¡†ï¼ˆå¯é€‰ï¼‰
- ðŸ“‹ å‘˜å·¥è§’è‰²æ˜¾ç¤ºï¼ˆåªè¯»ï¼Œä»Žé‚€è¯·ç èŽ·å–ï¼‰

**éªŒè¯é€»è¾‘**ï¼š
```javascript
// äº‘å‡½æ•°ï¼šç»‘å®šå‘˜å·¥ä¿¡æ¯
async function bindEmployee(inviteCode, phone, realName) {
  // 1. éªŒè¯é‚€è¯·ç 
  const invite = await db.collection('invite_codes')
    .where({
      code: inviteCode,
      used: false,
      expires_at: _.gt(new Date())
    })
    .get();

  if (invite.data.length === 0) {
    throw new Error('é‚€è¯·ç æ— æ•ˆæˆ–å·²è¿‡æœŸ');
  }

  // 2. æ£€æŸ¥æ‰‹æœºå·æ˜¯å¦å·²é¢„ç™»è®°
  const employee = await db.collection('employees')
    .where({
      phone,
      status: 'pending_bind' // å¾…ç»‘å®šçŠ¶æ€
    })
    .get();

  if (employee.data.length === 0) {
    throw new Error('è¯¥æ‰‹æœºå·æœªåœ¨ç³»ç»Ÿä¸­é¢„ç™»è®°ï¼Œè¯·è”ç³»HRç¡®è®¤');
  }

  // 3. éªŒè¯å§“åæ˜¯å¦åŒ¹é…
  if (employee.data[0].real_name !== realName) {
    throw new Error('å§“åä¸åŒ¹é…ï¼Œè¯·è¾“å…¥æ­£ç¡®çš„å§“å');
  }

  // 4. éªŒè¯è§’è‰²æ˜¯å¦åŒ¹é…
  if (employee.data[0].role_type !== invite.data[0].role_type) {
    throw new Error('é‚€è¯·ç ä¸Žæ‚¨çš„èŒä½ä¸åŒ¹é…');
  }

  // 5. ç»‘å®š openid
  await db.collection('employees').doc(employee.data[0]._id).update({
    data: {
      openid: OPENID,
      status: 'active',
      bound_at: new Date()
    }
  });

  // 6. åˆ›å»ºç”¨æˆ·è®°å½•
  await db.collection('users').add({
    data: {
      openid: OPENID,
      role_type: employee.data[0].role_type,
      role_id: employee.data[0]._id,
      created_at: new Date()
    }
  });

  // 7. æ ‡è®°é‚€è¯·ç å·²ä½¿ç”¨
  await db.collection('invite_codes').doc(invite.data[0]._id).update({
    data: {
      used: true,
      used_by: employee.data[0]._id,
      used_at: new Date()
    }
  });

  return {
    success: true,
    employeeId: employee.data[0]._id,
    roleType: employee.data[0].role_type
  };
}
```

#### å‘˜å·¥é¢„ç™»è®°æµç¨‹

**HRåŽå°æ“ä½œ**ï¼š
1. HRåœ¨åŽå°åˆ›å»ºå‘˜å·¥è®°å½•ï¼ˆé¢„ç™»è®°ï¼‰
   ```javascript
   // åˆ›å»ºå¾…ç»‘å®šçš„å‘˜å·¥è®°å½•
   await db.collection('employees').add({
     data: {
       real_name: 'å¼ ä¸‰',
       phone: '13800138000',
       role_type: 'agent',
       department: 'ç»çºªéƒ¨',
       openid: null, // æš‚æ—¶ä¸ºç©º
       status: 'pending_bind', // å¾…ç»‘å®š
       created_by: hrUserId,
       created_at: new Date()
     }
   });
   ```

2. ç”Ÿæˆå¯¹åº”è§’è‰²çš„é‚€è¯·ç 

3. å‘é€é‚€è¯·ç ç»™æ–°å‘˜å·¥ï¼ˆå¾®ä¿¡/çŸ­ä¿¡ï¼‰

4. æ–°å‘˜å·¥æ‰«ç åŽè‡ªåŠ¨ç»‘å®š

---

### åœºæ™¯3ï¼šæ— å‚æ•°ç›´æŽ¥æ‰“å¼€ ðŸŽ¯

#### è§¦å‘æ–¹å¼

- ç”¨æˆ·åœ¨å¾®ä¿¡æœç´¢å°ç¨‹åºåç§°
- ä»Žå°ç¨‹åºåŽ†å²è®°å½•æ‰“å¼€
- æ”¶è—åŽæ‰“å¼€

#### å¤„ç†æµç¨‹

æ˜¾ç¤º**èº«ä»½é€‰æ‹©é¡µ**ï¼Œå¼•å¯¼ç”¨æˆ·é€‰æ‹©èº«ä»½ã€‚

#### é¡µé¢è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    æ¬¢è¿Žä½¿ç”¨ Aomi Star       â”‚
â”‚      è¯·é€‰æ‹©æ‚¨çš„èº«ä»½          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ðŸ“¸                         â”‚
â”‚  æˆ‘è¦åº”è˜ä¸»æ’­                â”‚
â”‚  æŠ•é€’ç®€åŽ†ï¼Œå¼€å¯ç›´æ’­ä¹‹æ—…       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ðŸ”                         â”‚
â”‚  æˆ‘æ˜¯æ˜ŸæŽ¢                    â”‚
â”‚  æŽ¨èä¼˜è´¨ä¸»æ’­ï¼Œèµšå–ä½£é‡‘       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ðŸ’¼                         â”‚
â”‚  æˆ‘æ˜¯å…¬å¸å‘˜å·¥                â”‚
â”‚  é¦–æ¬¡ç™»å½•éœ€è¦é‚€è¯·ç           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### é€‰æ‹©å¤„ç†é€»è¾‘

```javascript
// pages/auth/role-select/role-select.js
Page({
  data: {
    userInfo: null
  },

  onLoad() {
    // èŽ·å–å¾®ä¿¡æŽˆæƒ
    this.getUserProfile();
  },

  // èŽ·å–ç”¨æˆ·æŽˆæƒ
  async getUserProfile() {
    try {
      const { userInfo } = await wx.getUserProfile({
        desc: 'ç”¨äºŽå®Œå–„ç”¨æˆ·èµ„æ–™'
      });
      this.setData({ userInfo });
    } catch (err) {
      console.log('ç”¨æˆ·å–æ¶ˆæŽˆæƒ', err);
    }
  },

  // é€‰æ‹©åº”è˜ä¸»æ’­
  async onSelectCandidate() {
    // 1. ç¡®ä¿å·²æŽˆæƒ
    if (!this.data.userInfo) {
      await this.getUserProfile();
      if (!this.data.userInfo) {
        return; // ç”¨æˆ·æ‹’ç»æŽˆæƒ
      }
    }

    // 2. è°ƒç”¨ç™»å½•ï¼Œæ£€æŸ¥æ˜¯å¦å·²æ³¨å†Œ
    wx.showLoading({ title: 'åŠ è½½ä¸­...' });

    try {
      const loginRes = await wx.cloud.callFunction({
        name: 'login',
        data: {}
      });

      const user = loginRes.result.user;

      if (user) {
        // ç”¨æˆ·å·²æ³¨å†Œï¼Œæ ¹æ®è§’è‰²è·³è½¬
        wx.hideLoading();

        if (user.role === 'candidate') {
          // å·²æ˜¯å€™é€‰äººï¼Œè·³è½¬åˆ°å€™é€‰äººå·¥ä½œå°
          wx.reLaunch({
            url: '/pages/candidate/home/home'
          });
        } else if (user.role === 'streamer') {
          // å·²æ˜¯ä¸»æ’­ï¼Œè·³è½¬åˆ°ä¸»æ’­å·¥ä½œå°
          wx.reLaunch({
            url: '/pages/streamer/home/home'
          });
        } else {
          // å…¶ä»–è§’è‰²ï¼Œæç¤ºä¸èƒ½é‡å¤æ³¨å†Œ
          wx.showModal({
            title: 'æç¤º',
            content: 'æ‚¨å·²æœ‰å…¶ä»–èº«ä»½ï¼Œä¸èƒ½é‡å¤æ³¨å†Œ',
            showCancel: false
          });
        }
      } else {
        // æœªæ³¨å†Œï¼Œè·³è½¬åˆ°æŠ¥åé¡µ
        wx.hideLoading();
        wx.navigateTo({
          url: '/pages/candidate/apply/apply'
        });
      }
    } catch (err) {
      wx.hideLoading();
      wx.showToast({
        title: 'åŠ è½½å¤±è´¥',
        icon: 'none'
      });
    }
  },

  // é€‰æ‹©æ˜ŸæŽ¢
  async onSelectScout() {
    // 1. ç¡®ä¿å·²æŽˆæƒ
    if (!this.data.userInfo) {
      await this.getUserProfile();
      if (!this.data.userInfo) {
        return;
      }
    }

    // 2. æ£€æŸ¥æ˜¯å¦å·²æ³¨å†Œ
    wx.showLoading({ title: 'åŠ è½½ä¸­...' });

    try {
      const loginRes = await wx.cloud.callFunction({
        name: 'login',
        data: {}
      });

      const user = loginRes.result.user;

      if (user && user.role === 'external_scout') {
        // å·²æ˜¯æ˜ŸæŽ¢ï¼Œè·³è½¬åˆ°æ˜ŸæŽ¢å·¥ä½œå°
        wx.hideLoading();
        wx.reLaunch({
          url: '/pages/scout-external/home/home'
        });
      } else if (user) {
        // å·²æœ‰å…¶ä»–è§’è‰²
        wx.hideLoading();
        wx.showModal({
          title: 'æç¤º',
          content: 'æ‚¨å·²æœ‰å…¶ä»–èº«ä»½ï¼Œä¸èƒ½é‡å¤æ³¨å†Œ',
          showCancel: false
        });
      } else {
        // æœªæ³¨å†Œï¼Œè·³è½¬åˆ°æ˜ŸæŽ¢æ³¨å†Œé¡µ
        wx.hideLoading();
        wx.navigateTo({
          url: '/pages/scout-external/register/register'
        });
      }
    } catch (err) {
      wx.hideLoading();
      wx.showToast({
        title: 'åŠ è½½å¤±è´¥',
        icon: 'none'
      });
    }
  },

  // é€‰æ‹©å‘˜å·¥
  onSelectEmployee() {
    wx.showModal({
      title: 'éœ€è¦é‚€è¯·ç ',
      content: 'å‘˜å·¥é¦–æ¬¡ç™»å½•éœ€è¦ä½¿ç”¨å…¬å¸HRå‘é€çš„é‚€è¯·é“¾æŽ¥ã€‚\n\nå¦‚æžœæ‚¨å·²æ”¶åˆ°é‚€è¯·ç ï¼Œè¯·ç‚¹å‡»"æˆ‘æœ‰é‚€è¯·ç "è¾“å…¥ã€‚\n\nå¦‚æžœå°šæœªæ”¶åˆ°ï¼Œè¯·è”ç³»æ‚¨çš„HRã€‚',
      confirmText: 'æˆ‘æœ‰é‚€è¯·ç ',
      cancelText: 'è”ç³»HR',
      success: (res) => {
        if (res.confirm) {
          // æ˜¾ç¤ºé‚€è¯·ç è¾“å…¥æ¡†
          this.showInviteCodeInput();
        } else {
          // æ˜¾ç¤ºHRè”ç³»æ–¹å¼
          this.showHRContact();
        }
      }
    });
  },

  // è¾“å…¥é‚€è¯·ç 
  showInviteCodeInput() {
    wx.navigateTo({
      url: '/pages/auth/invite-code-input/invite-code-input'
    });
  },

  // æ˜¾ç¤ºHRè”ç³»æ–¹å¼
  showHRContact() {
    wx.showModal({
      title: 'HRè”ç³»æ–¹å¼',
      content: 'HRç”µè¯ï¼š400-123-4567\nå·¥ä½œæ—¶é—´ï¼šå‘¨ä¸€è‡³å‘¨äº” 9:00-18:00',
      confirmText: 'æ‹¨æ‰“ç”µè¯',
      cancelText: 'æˆ‘çŸ¥é“äº†',
      success: (res) => {
        if (res.confirm) {
          wx.makePhoneCall({
            phoneNumber: '4001234567'
          });
        }
      }
    });
  }
});
```

#### "æˆ‘è¦åº”è˜ä¸»æ’­"å®Œæ•´æµç¨‹

ç”¨æˆ·é€‰æ‹©"æˆ‘è¦åº”è˜ä¸»æ’­"åŽçš„å¤„ç†æµç¨‹ï¼š

```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·
    participant MP as å°ç¨‹åº
    participant CF as äº‘å‡½æ•°
    participant DB as æ•°æ®åº“

    U->>MP: ç‚¹å‡»"æˆ‘è¦åº”è˜ä¸»æ’­"
    MP->>MP: æ£€æŸ¥æ˜¯å¦å·²æŽˆæƒ

    alt æœªæŽˆæƒ
    MP->>U: è¯·æ±‚å¾®ä¿¡æŽˆæƒ
    U->>MP: åŒæ„æŽˆæƒ
    end

    MP->>CF: è°ƒç”¨loginæ£€æŸ¥æ³¨å†ŒçŠ¶æ€
    CF->>DB: æŸ¥è¯¢ç”¨æˆ·(openid)

    alt ç”¨æˆ·å·²æ³¨å†Œ
    DB-->>CF: è¿”å›žç”¨æˆ·ä¿¡æ¯
    CF-->>MP: role='candidate'æˆ–'streamer'
    MP->>U: è·³è½¬å¯¹åº”å·¥ä½œå°
    else ç”¨æˆ·æœªæ³¨å†Œ
    DB-->>CF: ç”¨æˆ·ä¸å­˜åœ¨
    CF-->>MP: user=null
    MP->>U: è·³è½¬æŠ¥åé¡µé¢
    U->>MP: å¡«å†™æŠ¥åè¡¨å•
    MP->>CF: æäº¤æŠ¥å(createCandidate)
    CF->>DB: åˆ›å»ºç”¨æˆ·(role='candidate')
    CF->>DB: ä¿å­˜æŠ¥åä¿¡æ¯
    DB-->>CF: åˆ›å»ºæˆåŠŸ
    CF-->>MP: è¿”å›žuserId
    MP->>U: è·³è½¬å€™é€‰äººå·¥ä½œå°
    MP->>U: æ˜¾ç¤º"æŠ¥åæˆåŠŸ"æç¤º
    end
```

#### æŠ¥åé¡µé¢å®žçŽ°

```javascript
// pages/candidate/apply/apply.js
Page({
  data: {
    formData: {
      basicInfo: {
        name: '',
        phone: '',
        idCard: '',
        birthday: '',
        height: '',
        weight: ''
      },
      experience: {
        hasExperience: false,
        platforms: [],
        followersCount: ''
      },
      // ... å…¶ä»–è¡¨å•å­—æ®µ
    }
  },

  // æäº¤æŠ¥åè¡¨å•
  async submitApplication() {
    // 1. è¡¨å•éªŒè¯
    if (!this.validateForm()) {
      return;
    }

    wx.showLoading({ title: 'æäº¤ä¸­...' });

    try {
      // 2. è°ƒç”¨äº‘å‡½æ•°åˆ›å»ºå€™é€‰äººè´¦å·
      const res = await wx.cloud.callFunction({
        name: 'createCandidate',
        data: {
          formData: this.data.formData,
          scoutCode: null // ç›´æŽ¥æŠ¥åæ— æŽ¨èç 
        }
      });

      if (res.result.success) {
        wx.hideLoading();

        // 3. æ˜¾ç¤ºæˆåŠŸæç¤º
        await wx.showModal({
          title: 'æŠ¥åæˆåŠŸ',
          content: 'æ‚¨çš„ç®€åŽ†å·²æäº¤ï¼ŒHRå°†åœ¨3ä¸ªå·¥ä½œæ—¥å†…å®¡æ ¸ã€‚\n\nå®¡æ ¸ç»“æžœå°†é€šè¿‡å¾®ä¿¡æ¶ˆæ¯é€šçŸ¥æ‚¨ã€‚',
          showCancel: false,
          confirmText: 'æŸ¥çœ‹è¿›åº¦'
        });

        // 4. è·³è½¬åˆ°å€™é€‰äººå·¥ä½œå°
        wx.reLaunch({
          url: '/pages/candidate/home/home'
        });
      }
    } catch (err) {
      wx.hideLoading();
      wx.showModal({
        title: 'æäº¤å¤±è´¥',
        content: err.message || 'ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åŽé‡è¯•',
        showCancel: false
      });
    }
  },

  // è¡¨å•éªŒè¯
  validateForm() {
    const { basicInfo } = this.data.formData;

    if (!basicInfo.name) {
      wx.showToast({ title: 'è¯·è¾“å…¥å§“å', icon: 'none' });
      return false;
    }

    if (!basicInfo.phone || !/^1[3-9]\d{9}$/.test(basicInfo.phone)) {
      wx.showToast({ title: 'è¯·è¾“å…¥æ­£ç¡®çš„æ‰‹æœºå·', icon: 'none' });
      return false;
    }

    // ... å…¶ä»–éªŒè¯é€»è¾‘

    return true;
  }
});
```

---

## å°ç¨‹åºé¡µé¢æž¶æž„

### ç›®å½•ç»“æž„

```
miniprogram/
â”œâ”€â”€ app.js                      # å°ç¨‹åºå…¥å£
â”œâ”€â”€ app.json                    # å…¨å±€é…ç½®
â”œâ”€â”€ app.wxss                    # å…¨å±€æ ·å¼
â”‚
â”œâ”€â”€ pages/
â”‚   â”‚
â”‚   â”œâ”€â”€ auth/                   # è®¤è¯ç›¸å…³
â”‚   â”‚   â”œâ”€â”€ login/              # æŽˆæƒç™»å½•é¡µ
â”‚   â”‚   â”œâ”€â”€ role-select/        # èº«ä»½é€‰æ‹©é¡µ
â”‚   â”‚   â””â”€â”€ invite-input/       # é‚€è¯·ç è¾“å…¥é¡µ
â”‚   â”‚
â”‚   â”œâ”€â”€ candidate/              # ä¸»æ’­å€™é€‰äººç«¯
â”‚   â”‚   â”œâ”€â”€ home/               # å€™é€‰äººé¦–é¡µ
â”‚   â”‚   â”œâ”€â”€ apply/              # ç®€åŽ†æŠ•é€’
â”‚   â”‚   â”œâ”€â”€ interview/          # é¢è¯•ç›¸å…³
â”‚   â”‚   â”‚   â”œâ”€â”€ notice/         # é¢è¯•é€šçŸ¥
â”‚   â”‚   â”‚   â”œâ”€â”€ online/         # åœ¨çº¿é¢è¯•
â”‚   â”‚   â”‚   â””â”€â”€ result/         # é¢è¯•ç»“æžœ
â”‚   â”‚   â””â”€â”€ profile/            # ä¸ªäººèµ„æ–™
â”‚   â”‚
â”‚   â”œâ”€â”€ streamer/               # ä¸»æ’­ç«¯
â”‚   â”‚   â”œâ”€â”€ home/               # ä¸»æ’­é¦–é¡µ
â”‚   â”‚   â”œâ”€â”€ schedule/           # æŽ’ç­æŸ¥çœ‹
â”‚   â”‚   â”œâ”€â”€ training/           # åŸ¹è®­ä»»åŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ courses/        # è¯¾ç¨‹åˆ—è¡¨
â”‚   â”‚   â”‚   â”œâ”€â”€ practice/       # ç»ƒä¹ æäº¤
â”‚   â”‚   â”‚   â””â”€â”€ assessment/     # è€ƒæ ¸è®°å½•
â”‚   â”‚   â”œâ”€â”€ live/               # ç›´æ’­ç›¸å…³
â”‚   â”‚   â”‚   â”œâ”€â”€ prepare/        # ç›´æ’­å‡†å¤‡
â”‚   â”‚   â”‚   â””â”€â”€ data/           # ç›´æ’­æ•°æ®
â”‚   â”‚   â”œâ”€â”€ income/             # æ”¶ç›ŠæŸ¥çœ‹
â”‚   â”‚   â””â”€â”€ profile/            # ä¸ªäººä¸­å¿ƒ
â”‚   â”‚
â”‚   â”œâ”€â”€ employee/               # å‘˜å·¥ç«¯ï¼ˆç»Ÿä¸€æ¡†æž¶ï¼‰
â”‚   â”‚   â”œâ”€â”€ home/               # å‘˜å·¥é€šç”¨é¦–é¡µ
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ hr/                 # HR ä¸“å±žæ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ candidates/     # å€™é€‰äººç®¡ç†
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ list/       # å€™é€‰äººåˆ—è¡¨
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ detail/     # å€™é€‰äººè¯¦æƒ…
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ review/     # å®¡æ ¸å€™é€‰äºº
â”‚   â”‚   â”‚   â”œâ”€â”€ interviews/     # é¢è¯•ç®¡ç†
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ schedule/   # é¢è¯•å®‰æŽ’
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ evaluation/ # è¯„å®¡æ‰“åˆ†
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ result/     # ç»“æžœé€šçŸ¥
â”‚   â”‚   â”‚   â”œâ”€â”€ contracts/      # åˆåŒç®¡ç†
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ templates/  # åˆåŒæ¨¡æ¿
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ create/     # åˆ›å»ºåˆåŒ
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ list/       # åˆåŒåˆ—è¡¨
â”‚   â”‚   â”‚   â””â”€â”€ invites/        # é‚€è¯·ç ç®¡ç†
â”‚   â”‚   â”‚       â”œâ”€â”€ generate/   # ç”Ÿæˆé‚€è¯·ç 
â”‚   â”‚   â”‚       â””â”€â”€ list/       # é‚€è¯·ç åˆ—è¡¨
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ agent/              # ç»çºªäººä¸“å±žæ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ team/           # å›¢é˜Ÿç®¡ç†
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ list/       # ä¸»æ’­åˆ—è¡¨
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ detail/     # ä¸»æ’­è¯¦æƒ…
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ goals/      # ç›®æ ‡ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ schedule/       # æŽ’ç­ç®¡ç†
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ week/       # å‘¨æŽ’ç­
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ confirm/    # æŽ’ç­ç¡®è®¤
â”‚   â”‚   â”‚   â”œâ”€â”€ training/       # åŸ¹è®­ç®¡ç†
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ plans/      # åŸ¹è®­è®¡åˆ’
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ assessment/ # è€ƒæ ¸è¯„ä¼°
â”‚   â”‚   â”‚   â”œâ”€â”€ reports/        # å‘¨æŠ¥å¤ç›˜
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ create/     # åˆ›å»ºå‘¨æŠ¥
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ list/       # å‘¨æŠ¥åˆ—è¡¨
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ meeting/    # å¤ç›˜ä¼šè®®
â”‚   â”‚   â”‚   â””â”€â”€ income/         # æ”¶ç›Šç¡®è®¤
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ operator/           # è¿è¥ä¸“å±žæ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ schedule/       # æŽ’ç­ç³»ç»Ÿ
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ create/     # åˆ›å»ºæŽ’ç­
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ manage/     # æŽ’ç­ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ monitor/        # å®žæ—¶ç›‘æŽ§
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ dashboard/  # ç›‘æŽ§å¤§å±
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ alert/      # é¢„è­¦å¤„ç†
â”‚   â”‚   â”‚   â””â”€â”€ data/           # æ•°æ®åˆ†æž
â”‚   â”‚   â”‚       â”œâ”€â”€ daily/      # æ—¥æŠ¥
â”‚   â”‚   â”‚       â””â”€â”€ weekly/     # å‘¨æŠ¥
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ teacher/            # å¯¼å¸ˆä¸“å±žæ¨¡å—ï¼ˆé€šç”¨ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ students/       # å­¦å‘˜ç®¡ç†
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ list/       # å­¦å‘˜åˆ—è¡¨
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ detail/     # å­¦å‘˜è¯¦æƒ…
â”‚   â”‚   â”‚   â”œâ”€â”€ training/       # åŸ¹è®­è®¡åˆ’
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ plans/      # è®¡åˆ’åˆ—è¡¨
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ create/     # åˆ›å»ºè®¡åˆ’
â”‚   â”‚   â”‚   â”œâ”€â”€ records/        # è®­ç»ƒè®°å½•
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ list/       # è®°å½•åˆ—è¡¨
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ add/        # æ·»åŠ è®°å½•
â”‚   â”‚   â”‚   â””â”€â”€ resources/      # æ•™å­¦èµ„æº
â”‚   â”‚   â”‚       â”œâ”€â”€ videos/     # æ•™å­¦è§†é¢‘
â”‚   â”‚   â”‚       â””â”€â”€ upload/     # ä¸Šä¼ èµ„æº
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ finance/            # è´¢åŠ¡ä¸“å±žæ¨¡å—
â”‚   â”‚       â”œâ”€â”€ settlement/     # ç»“ç®—ç®¡ç†
â”‚   â”‚       â”‚   â”œâ”€â”€ list/       # ç»“ç®—åˆ—è¡¨
â”‚   â”‚       â”‚   â”œâ”€â”€ review/     # å®¡æ ¸ç»“ç®—
â”‚   â”‚       â”‚   â””â”€â”€ detail/     # ç»“ç®—è¯¦æƒ…
â”‚   â”‚       â”œâ”€â”€ transactions/   # äº¤æ˜“è®°å½•
â”‚   â”‚       â””â”€â”€ reports/        # è´¢åŠ¡æŠ¥è¡¨
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ videographer/      # æ‘„åƒå¸ˆä¸“å±žæ¨¡å—
â”‚   â”‚       â”œâ”€â”€ interviews/     # é¢è¯•å½•åˆ¶
â”‚   â”‚       â”‚   â”œâ”€â”€ list/       # å¾…å½•åˆ¶åˆ—è¡¨
â”‚   â”‚       â”‚   â”œâ”€â”€ record/     # å½•åˆ¶é¡µé¢
â”‚   â”‚       â”‚   â””â”€â”€ upload/     # ç´ æä¸Šä¼ 
â”‚   â”‚       â”œâ”€â”€ materials/      # ç´ æç®¡ç†
â”‚   â”‚       â”‚   â”œâ”€â”€ list/       # ç´ æåˆ—è¡¨
â”‚   â”‚       â”‚   â””â”€â”€ detail/     # ç´ æè¯¦æƒ…
â”‚   â”‚       â””â”€â”€ schedule/       # å½•åˆ¶æŽ’æœŸ
â”‚   â”‚
â”‚   â””â”€â”€ scout-external/         # å¤–éƒ¨æ˜ŸæŽ¢ç«¯
â”‚       â”œâ”€â”€ home/               # æ˜ŸæŽ¢é¦–é¡µ
â”‚       â”œâ”€â”€ register/           # æ˜ŸæŽ¢æ³¨å†Œ
â”‚       â”œâ”€â”€ recommend/          # æŽ¨èä¸»æ’­
â”‚       â”‚   â”œâ”€â”€ share/          # åˆ†äº«æŽ¨èç 
â”‚       â”‚   â””â”€â”€ qrcode/         # ç”ŸæˆäºŒç»´ç 
â”‚       â”œâ”€â”€ candidates/         # æŽ¨èè®°å½•
â”‚       â”‚   â”œâ”€â”€ list/           # å€™é€‰äººåˆ—è¡¨
â”‚       â”‚   â””â”€â”€ detail/         # å€™é€‰äººè¯¦æƒ…
â”‚       â””â”€â”€ commission/         # ä½£é‡‘ç®¡ç†
â”‚           â”œâ”€â”€ list/           # ä½£é‡‘æ˜Žç»†
â”‚           â””â”€â”€ withdraw/       # æçŽ°ç”³è¯·
â”‚
â”œâ”€â”€ components/                 # å…¬å…±ç»„ä»¶
â”‚   â”œâ”€â”€ role-header/            # è§’è‰²ä¸“å±žå¤´éƒ¨
â”‚   â”œâ”€â”€ data-card/              # æ•°æ®å¡ç‰‡
â”‚   â””â”€â”€ timeline/               # æ—¶é—´çº¿ç»„ä»¶
â”‚
â””â”€â”€ utils/                      # å·¥å…·å‡½æ•°
    â”œâ”€â”€ auth.js                 # è®¤è¯ç›¸å…³
    â”œâ”€â”€ router.js               # è·¯ç”±è·³è½¬
    â””â”€â”€ permission.js           # æƒé™æ£€æŸ¥
```

---

## å„è§’è‰²å·¥ä½œå°è®¾è®¡

### 1. å€™é€‰äººå·¥ä½œå°

#### é¦–é¡µå¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ðŸ‘¤ å¼ ä¸‰                                 â”‚
â”‚  ðŸ“± 138****8888                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ðŸ”„ ç”³è¯·è¿›åº¦                             â”‚
â”‚  â”â”â”â—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”       â”‚
â”‚  âœ… å·²æäº¤   â³ å®¡æ ¸ä¸­   â¸ï¸ å¾…é¢è¯•      â”‚
â”‚  â¸ï¸ å¾…å½•ç”¨   â¸ï¸ å¾…ç­¾çº¦                  â”‚
â”‚                                          â”‚
â”‚  å½“å‰çŠ¶æ€ï¼šå®¡æ ¸ä¸­                        â”‚
â”‚  é¢„è®¡åé¦ˆæ—¶é—´ï¼š3ä¸ªå·¥ä½œæ—¥å†…                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ðŸ“‹ æˆ‘çš„ç”³è¯·                             â”‚
â”‚  æäº¤æ—¶é—´ï¼š2025-01-05 14:30             â”‚
â”‚  æ¥æºï¼šæ˜ŸæŽ¢æŽ¨è (å¼ æ˜ŸæŽ¢)                 â”‚
â”‚  [æŸ¥çœ‹å®Œæ•´ç®€åŽ†] [ä¿®æ”¹ç®€åŽ†]               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ðŸ“… é¢è¯•å®‰æŽ’                             â”‚
â”‚                                          â”‚
â”‚  ðŸ“ çº¿ä¸Šé¢è¯•                             â”‚
â”‚  ðŸ• 2025-01-10 14:00-15:00             â”‚
â”‚  ðŸ‘¥ é¢è¯•å®˜ï¼šHR-æŽç»ç†ã€ç»çºªäºº-çŽ‹æ€»       â”‚
â”‚                                          â”‚
â”‚  [æŸ¥çœ‹é¢è¯•é¡»çŸ¥] [åŠ å…¥é¢è¯•é—´]             â”‚
â”‚  [é‡æ–°é¢„çº¦æ—¶é—´]                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ðŸ“¨ æœ€æ–°æ¶ˆæ¯ (2æ¡æœªè¯»)                   â”‚
â”‚                                          â”‚
â”‚  ðŸ”” æ‚¨çš„ç®€åŽ†å·²é€šè¿‡åˆå®¡                   â”‚
â”‚     HR-æŽç»ç† | 1å°æ—¶å‰                  â”‚
â”‚                                          â”‚
â”‚  ðŸ“ž é¢è¯•é‚€è¯·é€šçŸ¥                         â”‚
â”‚     ç³»ç»Ÿé€šçŸ¥ | 2å¤©å‰                     â”‚
â”‚                                          â”‚
â”‚  [æŸ¥çœ‹å…¨éƒ¨æ¶ˆæ¯]                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â„¹ï¸ å¸®åŠ©ä¸­å¿ƒ                             â”‚
â”‚  â€¢ å¦‚ä½•å‡†å¤‡é¢è¯•ï¼Ÿ                        â”‚
â”‚  â€¢ é¢è¯•å¸¸è§é—®é¢˜                          â”‚
â”‚  â€¢ è”ç³»HRï¼ˆå·¥ä½œæ—¥ 9:00-18:00ï¼‰          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### çŠ¶æ€è¯´æ˜Ž

å€™é€‰äººçŠ¶æ€ä¼šç»åŽ†ä»¥ä¸‹æµè½¬ï¼š

| çŠ¶æ€ | è¯´æ˜Ž | å€™é€‰äººå¯è§å†…å®¹ | å¯æ“ä½œåŠŸèƒ½ |
|------|------|---------------|----------|
| **pending** | ç®€åŽ†å¾…å®¡æ ¸ | "æ‚¨çš„ç®€åŽ†å·²æäº¤ï¼ŒHRæ­£åœ¨å®¡æ ¸ä¸­" | æŸ¥çœ‹ç®€åŽ†ã€ä¿®æ”¹ç®€åŽ† |
| **reviewing** | åˆå®¡ä¸­ | "åˆå®¡è¿›è¡Œä¸­ï¼Œé¢„è®¡3ä¸ªå·¥ä½œæ—¥åé¦ˆ" | æŸ¥çœ‹ç®€åŽ† |
| **interview_scheduled** | å·²å®‰æŽ’é¢è¯• | é¢è¯•æ—¶é—´ã€åœ°ç‚¹ã€é¢è¯•å®˜ä¿¡æ¯ | æŸ¥çœ‹é¢è¯•é¡»çŸ¥ã€åŠ å…¥é¢è¯•ã€æ”¹çº¦ |
| **interviewed** | é¢è¯•å·²å®Œæˆ | "é¢è¯•å·²å®Œæˆï¼Œç­‰å¾…æœ€ç»ˆç»“æžœ" | æŸ¥çœ‹é¢è¯•è®°å½• |
| **offered** | å·²å‘æ”¾Offer | Offerè¯¦æƒ…ã€è–ªèµ„å¾…é‡ã€ç­¾çº¦é¡»çŸ¥ | ç¡®è®¤æŽ¥å—ã€ç”³è¯·åå•† |
| **contract_pending** | å¾…ç­¾ç½²åˆåŒ | ç”µå­åˆåŒå†…å®¹ | ç­¾ç½²åˆåŒ |
| **signed** | å·²ç­¾çº¦ | "æ­å–œï¼å³å°†æˆä¸ºæ­£å¼ä¸»æ’­" | æŸ¥çœ‹åˆåŒã€ç­‰å¾…å…¥èŒ |
| **rejected** | æœªé€šè¿‡ | ä¸é€šè¿‡åŽŸå› ï¼ˆå¯é€‰ï¼‰ã€é¼“åŠ±è¯­ | æŸ¥çœ‹åé¦ˆã€6ä¸ªæœˆåŽé‡æ–°ç”³è¯· |

#### æ ¸å¿ƒåŠŸèƒ½

**1. å®žæ—¶è¿›åº¦è¿½è¸ª**
- âœ… å¯è§†åŒ–è¿›åº¦æ¡æ˜¾ç¤ºå½“å‰é˜¶æ®µ
- âœ… æ¯ä¸ªçŠ¶æ€å˜æ›´éƒ½ä¼šæ”¶åˆ°å¾®ä¿¡æ¨¡æ¿æ¶ˆæ¯é€šçŸ¥
- âœ… æ˜¾ç¤ºé¢„è®¡åé¦ˆæ—¶é—´ï¼Œè®¾ç½®ç”¨æˆ·æœŸæœ›

**2. ç®€åŽ†ç®¡ç†**
- âœ… æŸ¥çœ‹å·²æäº¤çš„å®Œæ•´ç®€åŽ†
- âœ… åœ¨å®¡æ ¸å‰å¯ä»¥ä¿®æ”¹ç®€åŽ†ï¼ˆpendingçŠ¶æ€ï¼‰
- âœ… å®¡æ ¸åŽä¸å¯ä¿®æ”¹ï¼Œä½†å¯ä»¥æŸ¥çœ‹HRå¤‡æ³¨

**3. é¢è¯•ç®¡ç†**
- âœ… æŸ¥çœ‹é¢è¯•æ—¶é—´ã€åœ°ç‚¹ã€é¢è¯•å®˜ä¿¡æ¯
- âœ… æŸ¥çœ‹é¢è¯•å‡†å¤‡é¡»çŸ¥å’Œå¸¸è§é—®é¢˜
- âœ… ä¸€é”®åŠ å…¥åœ¨çº¿é¢è¯•é—´ï¼ˆè…¾è®¯ä¼šè®®/é’‰é’‰ï¼‰
- âœ… é¢è¯•æ—¶é—´å†²çªå¯ç”³è¯·æ”¹çº¦
- âœ… é¢è¯•ç»“æŸåŽå¯æŸ¥çœ‹è¯„ä»·åé¦ˆ

**4. æ¶ˆæ¯ä¸­å¿ƒ**
- âœ… æŽ¥æ”¶ç³»ç»Ÿé€šçŸ¥ï¼ˆçŠ¶æ€å˜æ›´ã€é¢è¯•é‚€è¯·ï¼‰
- âœ… æŽ¥æ”¶HRæ¶ˆæ¯ï¼ˆåˆå®¡åé¦ˆã€é¢è¯•è¯„ä»·ï¼‰
- âœ… æœªè¯»æ¶ˆæ¯çº¢ç‚¹æé†’
- âœ… æ¶ˆæ¯ä¸Žå¾®ä¿¡æ¨¡æ¿æ¶ˆæ¯åŒæ­¥

**5. ç”µå­ç­¾çº¦**
- âœ… æŸ¥çœ‹Offerè¯¦æƒ…ï¼ˆå²—ä½ã€è–ªèµ„ã€ç¦åˆ©ï¼‰
- âœ… åœ¨çº¿ç­¾ç½²ç”µå­åˆåŒ
- âœ… æŸ¥çœ‹å·²ç­¾ç½²çš„åˆåŒå‰¯æœ¬
- âœ… åˆåŒæ¡æ¬¾å¯ç‚¹å‡»æŸ¥çœ‹è¯¦ç»†è¯´æ˜Ž

**6. å¸®åŠ©æ”¯æŒ**
- âœ… é¢è¯•å‡†å¤‡æŒ‡å—
- âœ… å¸¸è§é—®é¢˜è§£ç­”
- âœ… åœ¨çº¿è”ç³»HRï¼ˆå·¥ä½œæ—¶é—´ï¼‰

---

### 2. ä¸»æ’­å·¥ä½œå°

#### é¦–é¡µå¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ðŸ‘¤ è‰ºåï¼šå°æ˜Ÿæ˜Ÿ             â”‚
â”‚  ç»çºªäººï¼šæŽç»ç†  çº§åˆ«ï¼šBçº§   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ðŸ“Š æœ¬å‘¨æ•°æ®æ¦‚è§ˆ             â”‚
â”‚  ç›´æ’­: 5åœº  æ—¶é•¿: 18å°æ—¶     â”‚
â”‚  æ”¶ç›Š: Â¥8,500               â”‚
â”‚  æ¶¨ç²‰: +320                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ðŸ“… æœ¬å‘¨æŽ’ç­                 â”‚
â”‚  å‘¨ä¸€ 19:00-22:00 é»„é‡‘æ¡£     â”‚
â”‚  å‘¨ä¸‰ 14:00-17:00 ç™½é“¶æ¡£     â”‚
â”‚  ...                        â”‚
â”‚  [æŸ¥çœ‹å®Œæ•´æŽ’ç­]              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ðŸ“š åŸ¹è®­ä»»åŠ¡                 â”‚
â”‚  å¾…å®Œæˆè¯¾ç¨‹: 2ä¸ª             â”‚
â”‚  å¾…æäº¤ç»ƒä¹ : 1ä¸ª             â”‚
â”‚  [æŸ¥çœ‹è¯¦æƒ…]                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ðŸ’° æ”¶ç›Šæ˜Žç»†                 â”‚
â”‚  æœ¬æœˆé¢„ä¼°: Â¥25,800          â”‚
â”‚  [æŸ¥çœ‹è¯¦æƒ…]                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ ¸å¿ƒåŠŸèƒ½

- âœ… æŸ¥çœ‹æŽ’ç­ä¿¡æ¯
- âœ… æŸ¥çœ‹åŸ¹è®­ä»»åŠ¡
- âœ… æäº¤ç»ƒä¹ è§†é¢‘
- âœ… æŸ¥çœ‹ç›´æ’­æ•°æ®
- âœ… æŸ¥çœ‹æ”¶ç›Šæ˜Žç»†
- âœ… æŸ¥çœ‹å‘¨æŠ¥åé¦ˆ
- âœ… ä¸ªäººæ¡£æ¡ˆç®¡ç†

---

### 3. å‘˜å·¥å·¥ä½œå°ï¼ˆä»¥ç»çºªäººä¸ºä¾‹ï¼‰

#### é¦–é¡µå¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ðŸ’¼ ç»çºªäººï¼šæŽæ˜Ž             â”‚
â”‚  éƒ¨é—¨ï¼šç»çºªéƒ¨                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ðŸ‘¥ æˆ‘çš„å›¢é˜Ÿ (12äºº)          â”‚
â”‚  Sçº§: 2äºº  Açº§: 4äºº          â”‚
â”‚  Bçº§: 5äºº  Cçº§: 1äºº          â”‚
â”‚  [æŸ¥çœ‹å›¢é˜Ÿ]                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ðŸ“Š æœ¬å‘¨å›¢é˜Ÿæ•°æ®             â”‚
â”‚  æ€»æ”¶ç›Š: Â¥125,000           â”‚
â”‚  æ€»æ¶¨ç²‰: +2,580             â”‚
â”‚  å®ŒæˆçŽ‡: 95%                â”‚
â”‚  [æŸ¥çœ‹è¯¦æƒ…]                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ðŸ“… æœ¬å‘¨æŽ’ç­                 â”‚
â”‚  å¾…ç¡®è®¤: 3äºº                â”‚
â”‚  [åŽ»ç¡®è®¤]                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ðŸ“ å‘¨æŠ¥å¤ç›˜                 â”‚
â”‚  æœ¬å‘¨äº” 15:00 å¤ç›˜ä¼šè®®       â”‚
â”‚  [æŸ¥çœ‹ä¸Šå‘¨å‘¨æŠ¥]              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âš ï¸ å¾…åŠžäº‹é¡¹                â”‚
â”‚  â€¢ å°æ˜Ÿæ˜Ÿå‘¨æŠ¥å¾…å¡«å†™           â”‚
â”‚  â€¢ æ–°äººè€ƒæ ¸å¾…è¯„ä¼°             â”‚
â”‚  [æŸ¥çœ‹å…¨éƒ¨]                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ ¸å¿ƒåŠŸèƒ½

- âœ… å›¢é˜Ÿç®¡ç†ï¼ˆ12-15åä¸»æ’­ï¼‰
- âœ… æŽ’ç­ç¡®è®¤
- âœ… åŸ¹è®­è®¡åˆ’åˆ¶å®š
- âœ… å‘¨æŠ¥å¤ç›˜
- âœ… æ”¶ç›Šç¡®è®¤
- âœ… æ•°æ®åˆ†æž

---

### 4. å¤–éƒ¨æ˜ŸæŽ¢å·¥ä½œå°

#### é¦–é¡µå¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ðŸ” æ˜ŸæŽ¢ï¼šçŽ‹æŽ¨è             â”‚
â”‚  ä½£é‡‘ç­‰çº§ï¼šé‡‘ç‰Œæ˜ŸæŽ¢          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ðŸ“Š æœ¬æœˆæ•°æ®                 â”‚
â”‚  æŽ¨èäººæ•°: 8äºº               â”‚
â”‚  æˆåŠŸç­¾çº¦: 3äºº               â”‚
â”‚  ä½£é‡‘æ”¶å…¥: Â¥4,500           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ðŸ“± æˆ‘çš„æŽ¨èç                â”‚
â”‚  SC-EXT-20250102-A3B9       â”‚
â”‚  [å¤åˆ¶] [ç”ŸæˆäºŒç»´ç ]         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ðŸ‘¥ æŽ¨èè®°å½• (8äºº)           â”‚
â”‚  å¾…é¢è¯•: 2äºº                â”‚
â”‚  é¢è¯•ä¸­: 3äºº                â”‚
â”‚  å·²ç­¾çº¦: 3äºº                â”‚
â”‚  [æŸ¥çœ‹è¯¦æƒ…]                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ðŸ’° ä½£é‡‘æ˜Žç»†                 â”‚
â”‚  æœ¬æœˆ: Â¥4,500               â”‚
â”‚  ç´¯è®¡: Â¥28,900              â”‚
â”‚  å¯æçŽ°: Â¥15,000            â”‚
â”‚  [åŽ»æçŽ°]                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ ¸å¿ƒåŠŸèƒ½

- âœ… ç”ŸæˆæŽ¨èç 
- âœ… åˆ†äº«æŽ¨èé“¾æŽ¥
- âœ… æŸ¥çœ‹æŽ¨èè®°å½•
- âœ… æŸ¥çœ‹ä½£é‡‘æ˜Žç»†
- âœ… ç”³è¯·æçŽ°
- âœ… æŸ¥çœ‹è½¬åŒ–æ•°æ®

---

## è§’è‰²å‡çº§æœºåˆ¶

### å€™é€‰äºº â†’ ä¸»æ’­å‡çº§æµç¨‹

#### è§¦å‘æ¡ä»¶

å½“å€™é€‰äººå®Œæˆä»¥ä¸‹æ‰€æœ‰æ­¥éª¤åŽï¼Œç³»ç»Ÿè‡ªåŠ¨å°†è§’è‰²ä»Ž `candidate` å‡çº§ä¸º `streamer`ï¼š

1. âœ… é€šè¿‡æ‰€æœ‰é¢è¯•çŽ¯èŠ‚
2. âœ… èŽ·å¾—å½•ç”¨Offer
3. âœ… å®Œæˆç”µå­åˆåŒç­¾ç½²
4. âœ… HRç¡®è®¤å…¥èŒ

#### å‡çº§æ—¶æœº

```javascript
// äº‘å‡½æ•°ï¼šconfirmContract - HRç¡®è®¤åˆåŒç­¾ç½²å®ŒæˆåŽè°ƒç”¨
exports.main = async (event, context) => {
  const { userId, contractId } = event;

  // 1. éªŒè¯åˆåŒçŠ¶æ€
  const contract = await db.collection('contracts')
    .doc(contractId)
    .get();

  if (contract.data.status !== 'signed') {
    throw new Error('åˆåŒå°šæœªç­¾ç½²');
  }

  // 2. æ›´æ–°ç”¨æˆ·è§’è‰²
  await db.collection('users').doc(userId).update({
    data: {
      role: 'streamer', // ä»Ž candidate å‡çº§ä¸º streamer
      roleUpgradedAt: new Date(),

      // ä¿ç•™å€™é€‰äººä¿¡æ¯ä½œä¸ºåŽ†å²è®°å½•
      candidateHistory: {
        appliedAt: _.get('candidateInfo.applyAt'),
        source: _.get('candidateInfo.source'),
        scoutCode: _.get('candidateInfo.scoutCode'),
        upgradedAt: new Date()
      },

      // åˆå§‹åŒ–ä¸»æ’­ä¿¡æ¯
      streamerInfo: {
        status: 'onboarding', // å…¥èŒä¸­
        stageLevel: 'trainee', // å®žä¹ ä¸»æ’­
        agentId: contract.data.agentId, // åˆ†é…çš„ç»çºªäºº
        contractId: contractId,
        joinedAt: new Date(),

        // åˆå§‹æ•°æ®
        totalLiveHours: 0,
        totalIncome: 0,
        followerCount: 0
      }
    }
  });

  // 3. å¦‚æžœæœ‰æ˜ŸæŽ¢æŽ¨èï¼Œæ›´æ–°æŽ¨èçŠ¶æ€ä¸º"å·²è½¬åŒ–"
  if (contract.data.scoutCode) {
    await db.collection('referral_records')
      .where({
        userId: userId,
        scoutCode: contract.data.scoutCode
      })
      .update({
        data: {
          status: 'converted', // ä»Ž pending å˜ä¸º converted
          convertedAt: new Date(),
          contractId: contractId
        }
      });
  }

  // 4. å‘é€é€šçŸ¥
  await sendTemplateMessage({
    touser: contract.data.candidateOpenid,
    template_id: 'WELCOME_STREAMER',
    data: {
      name: contract.data.candidateName,
      agent: contract.data.agentName,
      startDate: contract.data.startDate
    }
  });

  return { success: true, newRole: 'streamer' };
};
```

#### æ•°æ®å˜æ›´å¯¹æ¯”

| å­—æ®µ | å‡çº§å‰ï¼ˆcandidateï¼‰ | å‡çº§åŽï¼ˆstreamerï¼‰ |
|------|-------------------|-------------------|
| **role** | `candidate` | `streamer` |
| **candidateInfo** | å®Œæ•´ä¿¡æ¯ | ç§»è‡³ candidateHistory |
| **streamerInfo** | ä¸å­˜åœ¨ | æ–°å»ºï¼ŒåŒ…å«ä¸»æ’­æ¡£æ¡ˆ |
| **å·¥ä½œå°è®¿é—®** | `/pages/candidate/home` | `/pages/streamer/home` |
| **æƒé™** | æŸ¥çœ‹ç”³è¯·è¿›åº¦ã€é¢è¯• | æŸ¥çœ‹æŽ’ç­ã€åŸ¹è®­ã€ç›´æ’­æ•°æ® |

#### å‡çº§åŽé¦–æ¬¡ç™»å½•æµç¨‹

```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·
    participant MP as å°ç¨‹åº
    participant CF as äº‘å‡½æ•°
    participant DB as æ•°æ®åº“

    U->>MP: æ‰“å¼€å°ç¨‹åº
    MP->>CF: getUserInfo (openid)
    CF->>DB: æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯
    DB-->>CF: role = 'streamer'
    CF-->>MP: è¿”å›žä¸»æ’­ä¿¡æ¯

    alt é¦–æ¬¡ç™»å½•ï¼ˆisFirstStreamerLogin=trueï¼‰
    MP->>U: æ˜¾ç¤ºæ¬¢è¿Žå¼•å¯¼é¡µ
    MP->>U: "æ­å–œæˆä¸ºæ­£å¼ä¸»æ’­ï¼"
    MP->>U: ä»‹ç»ä¸»æ’­å·¥ä½œå°åŠŸèƒ½
    MP->>CF: æ ‡è®°å·²å®Œæˆå¼•å¯¼
    end

    MP->>U: è·³è½¬ä¸»æ’­å·¥ä½œå°
```

#### è§’è‰²å‡çº§åŽçš„æ¶ˆæ¯é€šçŸ¥

**1. å¾®ä¿¡æ¨¡æ¿æ¶ˆæ¯**
```javascript
{
  touser: 'OPENID',
  template_id: 'ROLE_UPGRADE_TEMPLATE',
  page: '/pages/streamer/home/home',
  data: {
    title: 'è§’è‰²å‡çº§é€šçŸ¥',
    content: 'æ­å–œæ‚¨æˆä¸ºæ­£å¼ä¸»æ’­ï¼',
    time: '2025-01-15 10:00',
    remark: 'ç‚¹å‡»æŸ¥çœ‹æ‚¨çš„ä¸»æ’­å·¥ä½œå°'
  }
}
```

**2. ç«™å†…æ¶ˆæ¯**
```javascript
{
  userId: 'USER_ID',
  type: 'role_upgrade',
  title: 'ðŸŽ‰ æ¬¢è¿ŽåŠ å…¥ä¸»æ’­å›¢é˜Ÿ',
  content: 'æ‚¨å·²å®Œæˆç­¾çº¦ï¼Œè§’è‰²å‡çº§ä¸ºæ­£å¼ä¸»æ’­ã€‚\n\næ‚¨çš„ç»çºªäººï¼šæŽç»ç†\né¦–æ¬¡åŸ¹è®­æ—¶é—´ï¼š2025-01-16 14:00\n\nè¯·è®¿é—®ä¸»æ’­å·¥ä½œå°æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ã€‚',
  read: false,
  createdAt: new Date()
}
```

#### å›žé€€æœºåˆ¶ï¼ˆç‰¹æ®Šæƒ…å†µï¼‰

åœ¨æžå°‘æ•°æƒ…å†µä¸‹ï¼ˆå¦‚åˆåŒç­¾ç½²å‡ºé”™ã€å€™é€‰äººæ”¾å¼ƒå…¥èŒç­‰ï¼‰ï¼ŒHRå¯ä»¥å›žé€€è§’è‰²ï¼š

```javascript
// äº‘å‡½æ•°ï¼šrollbackRoleï¼ˆéœ€è¦HRæƒé™ï¼‰
exports.main = async (event, context) => {
  const { userId, reason } = event;

  // éªŒè¯æƒé™
  const caller = await getCurrentUser(context.OPENID);
  if (!['hr_admin', 'super_admin'].includes(caller.roleType)) {
    throw new Error('æ— æƒé™æ‰§è¡Œæ­¤æ“ä½œ');
  }

  // å›žé€€è§’è‰²
  await db.collection('users').doc(userId).update({
    data: {
      role: 'candidate',

      // ä»ŽåŽ†å²è®°å½•æ¢å¤å€™é€‰äººä¿¡æ¯
      candidateInfo: _.get('candidateHistory'),

      // æ¸…é™¤ä¸»æ’­ä¿¡æ¯
      streamerInfo: _.remove(),

      // è®°å½•å›žé€€æ—¥å¿—
      roleChangeLog: _.push({
        from: 'streamer',
        to: 'candidate',
        reason: reason,
        operator: caller.userId,
        operatedAt: new Date()
      })
    }
  });

  return { success: true };
};
```

#### æ³¨æ„äº‹é¡¹

âš ï¸ **é‡è¦æé†’**ï¼š

1. **ä¸å¯é€†æ€§**ï¼šè§’è‰²å‡çº§é€šå¸¸ä¸å¯é€†ï¼Œé™¤éžHRæ‰‹åŠ¨å›žé€€
2. **æ•°æ®å®Œæ•´æ€§**ï¼šå‡çº§å‰ç¡®ä¿æ‰€æœ‰å€™é€‰äººä¿¡æ¯å®Œæ•´
3. **æƒé™å˜æ›´**ï¼šå‡çº§åŽå€™é€‰äººå·¥ä½œå°å°†ä¸å¯è®¿é—®
4. **é€šçŸ¥åŠæ—¶æ€§**ï¼šå‡çº§åŽç«‹å³å‘é€é€šçŸ¥ï¼Œé¿å…ç”¨æˆ·å›°æƒ‘
5. **åŽ†å²è®°å½•**ï¼šcandidateHistoryä¿ç•™å®Œæ•´çš„åº”è˜åŽ†å²ï¼Œä¸å¯åˆ é™¤
6. **æ˜ŸæŽ¢ä½£é‡‘**ï¼šè§’è‰²å‡çº§ä¼šè§¦å‘æ˜ŸæŽ¢ä½£é‡‘ç»“ç®—æµç¨‹

---

## é‚€è¯·ç å’ŒæŽ¨èç æœºåˆ¶

### å‘˜å·¥é‚€è¯·ç æœºåˆ¶

#### ç”Ÿæˆè§„åˆ™

**æ ¼å¼**ï¼š`INV-{è§’è‰²ç®€ç§°}-{æ—¶é—´æˆ³}-{éšæœºç }`

**ç¤ºä¾‹**ï¼š
- `INV-HR-20250102-X7Y9` - HRé‚€è¯·ç 
- `INV-AG-20250102-B3K8` - ç»çºªäººé‚€è¯·ç 
- `INV-OP-20250102-M5N2` - è¿è¥ä¸“å‘˜é‚€è¯·ç 

#### æœ‰æ•ˆæœŸç®¡ç†

- â± **é»˜è®¤æœ‰æ•ˆæœŸ**ï¼š7å¤©
- â™»ï¸ **å¯é‡æ–°ç”Ÿæˆ**ï¼šè¿‡æœŸåŽHRå¯é‡æ–°ç”Ÿæˆ
- ðŸ”’ **ä¸€æ¬¡æ€§ä½¿ç”¨**ï¼šæ¯ä¸ªé‚€è¯·ç åªèƒ½ä½¿ç”¨ä¸€æ¬¡
- âŒ **å¯ä½œåºŸ**ï¼šHRå¯æ‰‹åŠ¨ä½œåºŸæœªä½¿ç”¨çš„é‚€è¯·ç 

#### ä½¿ç”¨æµç¨‹

```mermaid
sequenceDiagram
    participant HR as HR
    participant System as ç³»ç»Ÿ
    participant NewEmp as æ–°å‘˜å·¥

    HR->>System: åˆ›å»ºå‘˜å·¥è®°å½•
    HR->>System: ç”Ÿæˆé‚€è¯·ç 
    System-->>HR: è¿”å›žé‚€è¯·ç å’ŒäºŒç»´ç 
    HR->>NewEmp: å‘é€é‚€è¯·ç 
    NewEmp->>System: æ‰«ç è¿›å…¥å°ç¨‹åº
    System->>System: éªŒè¯é‚€è¯·ç 
    NewEmp->>System: è¾“å…¥æ‰‹æœºå·+å§“å
    System->>System: éªŒè¯ä¿¡æ¯åŒ¹é…
    System->>System: ç»‘å®šopenid
    System->>System: æ ‡è®°é‚€è¯·ç å·²ä½¿ç”¨
    System-->>NewEmp: è·³è½¬å·¥ä½œå°
```

---

### æ˜ŸæŽ¢æŽ¨èç æœºåˆ¶

#### ç”Ÿæˆè§„åˆ™

**æ ¼å¼**ï¼š`SC-{ç±»åž‹}-{æ—¶é—´æˆ³}-{éšæœºç }`

**ç±»åž‹**ï¼š
- `INT` - å†…éƒ¨ä¸“èŒæ˜ŸæŽ¢
- `EXT` - å¤–éƒ¨åˆä½œæ˜ŸæŽ¢

**ç¤ºä¾‹**ï¼š
- `SC-INT-20250102-A3B9` - å†…éƒ¨æ˜ŸæŽ¢æŽ¨èç 
- `SC-EXT-20250102-K7M5` - å¤–éƒ¨æ˜ŸæŽ¢æŽ¨èç 

#### æŽ¨èç ç‰¹æ€§

- ðŸ”„ **æ°¸ä¹…æœ‰æ•ˆ**ï¼šæ˜ŸæŽ¢æŽ¨èç é•¿æœŸæœ‰æ•ˆ
- â™¾ï¸ **æ— é™ä½¿ç”¨**ï¼šå¯ä»¥æŽ¨èæ— é™å¤šäºº
- ðŸ“Š **æ•°æ®è¿½è¸ª**ï¼šè®°å½•æ¯ä¸ªæŽ¨èçš„è½¬åŒ–æƒ…å†µ
- ðŸ’° **ä½£é‡‘ç»‘å®š**ï¼šè‡ªåŠ¨ç»‘å®šä½£é‡‘å…³ç³»

#### ä½£é‡‘è®¡ç®—è§„åˆ™

**ç­¾çº¦å¥–é‡‘**ï¼š
- å€™é€‰äººæˆåŠŸç­¾çº¦ â†’ æ˜ŸæŽ¢èŽ·å¾— Â¥500 ç­¾çº¦å¥–é‡‘

**æŒç»­ä½£é‡‘**ï¼ˆå‰3ä¸ªæœˆï¼‰ï¼š
- ä¸»æ’­æœˆæ”¶ç›Š Ã— 5% = æ˜ŸæŽ¢æœˆä½£é‡‘

**ç¤ºä¾‹**ï¼š
```
ç¬¬1ä¸ªæœˆï¼šä¸»æ’­æ”¶ç›Š Â¥10,000 â†’ æ˜ŸæŽ¢ä½£é‡‘ Â¥500
ç¬¬2ä¸ªæœˆï¼šä¸»æ’­æ”¶ç›Š Â¥15,000 â†’ æ˜ŸæŽ¢ä½£é‡‘ Â¥750
ç¬¬3ä¸ªæœˆï¼šä¸»æ’­æ”¶ç›Š Â¥20,000 â†’ æ˜ŸæŽ¢ä½£é‡‘ Â¥1,000
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ç­¾çº¦å¥–é‡‘ï¼šÂ¥500
æŒç»­ä½£é‡‘ï¼šÂ¥2,250
æ€»è®¡ä½£é‡‘ï¼šÂ¥2,750
```

#### æŽ¨èå…³ç³»è¿½è¸ª

```sql
-- referral_records è¡¨
{
  candidate_id: 123,
  scout_id: 456,
  scout_type: 'external',
  scout_code: 'SC-EXT-20250102-K7M5',
  referred_at: '2025-01-05',
  status: 'signed', // pending/interviewed/signed/rejected
  commission_rate: 0.05,
  total_commission: 2750.00,
  paid_commission: 2750.00,
  last_commission_date: '2025-04-30'
}
```

---

## å®‰å…¨é˜²æŠ¤æœºåˆ¶

### 1. é˜²æ­¢é‡å¤æ³¨å†Œ

#### æ£€æŸ¥è§„åˆ™

```javascript
async function checkDuplicateRegistration(openid, phone) {
  // 1. æ£€æŸ¥ openid æ˜¯å¦å·²æ³¨å†Œ
  const existByOpenid = await db.collection('users')
    .where({ openid })
    .count();

  if (existByOpenid.total > 0) {
    throw new Error('è¯¥å¾®ä¿¡è´¦å·å·²æ³¨å†Œï¼Œä¸€ä¸ªå¾®ä¿¡è´¦å·åªèƒ½ç»‘å®šä¸€ä¸ªèº«ä»½');
  }

  // 2. æ£€æŸ¥æ‰‹æœºå·æ˜¯å¦å·²è¢«ä½¿ç”¨ï¼ˆä»…å€™é€‰äººå’Œæ˜ŸæŽ¢ï¼‰
  if (roleType === 'candidate' || roleType === 'scout_external') {
    const existByPhone = await db.collection('candidates')
      .where({ phone })
      .count();

    if (existByPhone.total > 0) {
      throw new Error('è¯¥æ‰‹æœºå·å·²è¢«æ³¨å†Œ');
    }
  }
}
```

---

### 2. é˜²æ­¢è§’è‰²æ··ä¹±

#### åŽŸåˆ™

- âœ… ä¸€ä¸ªå¾®ä¿¡è´¦å·åªèƒ½ç»‘å®šä¸€ä¸ªä¸»è¦èº«ä»½
- âœ… å€™é€‰äºº â†’ ä¸»æ’­æ˜¯è‡ªç„¶å‡çº§ï¼ˆåŒä¸€è´¦å·ï¼‰
- âŒ ä¸å…è®¸ä¸€äººæ—¢æ˜¯ä¸»æ’­åˆæ˜¯æ˜ŸæŽ¢
- âŒ ä¸å…è®¸ä¸€äººæ—¢æ˜¯å‘˜å·¥åˆæ˜¯å¤–éƒ¨æ˜ŸæŽ¢

#### å®žçŽ°

```javascript
// ç”¨æˆ·è¡¨è®¾è®¡
{
  _id: 'user_001',
  openid: 'wx_xxx',
  role_type: 'streamer', // å½“å‰è§’è‰²
  role_id: 123, // å¯¹åº”è§’è‰²è¡¨çš„ID
  role_history: [
    { role: 'candidate', changed_at: '2025-01-05' },
    { role: 'streamer', changed_at: '2025-01-20' }
  ],
  can_switch_role: false // æ˜¯å¦å…è®¸åˆ‡æ¢è§’è‰²
}
```

---

### 3. é‚€è¯·ç å®‰å…¨

#### éªŒè¯è§„åˆ™

```javascript
async function verifyInviteCode(code) {
  const invite = await db.collection('invite_codes')
    .where({ code })
    .get();

  // æ£€æŸ¥1: é‚€è¯·ç æ˜¯å¦å­˜åœ¨
  if (invite.data.length === 0) {
    throw new Error('é‚€è¯·ç ä¸å­˜åœ¨');
  }

  const inviteData = invite.data[0];

  // æ£€æŸ¥2: æ˜¯å¦å·²ä½¿ç”¨
  if (inviteData.used) {
    throw new Error('è¯¥é‚€è¯·ç å·²è¢«ä½¿ç”¨');
  }

  // æ£€æŸ¥3: æ˜¯å¦è¿‡æœŸ
  if (new Date() > new Date(inviteData.expires_at)) {
    throw new Error('é‚€è¯·ç å·²è¿‡æœŸ');
  }

  return inviteData;
}
```

#### é˜²æ­¢æš´åŠ›ç ´è§£

```javascript
// é™åˆ¶é‚€è¯·ç éªŒè¯æ¬¡æ•°
const MAX_VERIFY_ATTEMPTS = 5;
const LOCK_DURATION = 30 * 60 * 1000; // 30åˆ†é’Ÿ

async function checkVerifyAttempts(openid) {
  const attempts = await redis.get(`invite_verify:${openid}`);

  if (attempts && attempts >= MAX_VERIFY_ATTEMPTS) {
    const lockExpire = await redis.ttl(`invite_verify:${openid}`);
    throw new Error(`éªŒè¯æ¬¡æ•°è¿‡å¤šï¼Œè¯·åœ¨${Math.ceil(lockExpire / 60)}åˆ†é’ŸåŽé‡è¯•`);
  }

  // å¢žåŠ å°è¯•æ¬¡æ•°
  await redis.incr(`invite_verify:${openid}`);
  await redis.expire(`invite_verify:${openid}`, LOCK_DURATION / 1000);
}
```

---

### 4. æŽ¨èç é˜²æ»¥ç”¨

#### é™åˆ¶è§„åˆ™

- â± **é¢‘çŽ‡é™åˆ¶**ï¼šåŒä¸€æ˜ŸæŽ¢æ¯å¤©æœ€å¤šæŽ¨è10äºº
- ðŸ” **å¼‚å¸¸æ£€æµ‹**ï¼šè¯†åˆ«æ‰¹é‡æ³¨å†Œè¡Œä¸º
- âŒ **é»‘åå•æœºåˆ¶**ï¼šä½œå¼Šæ˜ŸæŽ¢æ°¸ä¹…å°ç¦

#### å®žçŽ°

```javascript
// æ£€æŸ¥æŽ¨èé¢‘çŽ‡
async function checkRecommendFrequency(scoutId) {
  const today = new Date().toISOString().split('T')[0];

  const count = await db.collection('referral_records')
    .where({
      scout_id: scoutId,
      referred_at: db.command.gte(new Date(today))
    })
    .count();

  if (count.total >= 10) {
    throw new Error('ä»Šæ—¥æŽ¨èæ¬¡æ•°å·²è¾¾ä¸Šé™ï¼ˆ10äºº/å¤©ï¼‰');
  }
}

// å¼‚å¸¸æ£€æµ‹
async function detectAbnormalBehavior(scoutId) {
  // æ£€æµ‹1: çŸ­æ—¶é—´å†…å¤§é‡æŽ¨è
  const last1Hour = await db.collection('referral_records')
    .where({
      scout_id: scoutId,
      referred_at: db.command.gte(new Date(Date.now() - 60 * 60 * 1000))
    })
    .count();

  if (last1Hour.total > 5) {
    await flagScoutForReview(scoutId, 'çŸ­æ—¶é—´å†…å¤§é‡æŽ¨è');
  }

  // æ£€æµ‹2: æŽ¨èçš„å€™é€‰äººè´¨é‡è¿‡ä½Ž
  const recentCandidates = await db.collection('referral_records')
    .where({
      scout_id: scoutId,
      referred_at: db.command.gte(new Date(Date.now() - 7 * 24 * 60 * 60 * 1000))
    })
    .get();

  const rejectedCount = recentCandidates.data.filter(r => r.status === 'rejected').length;
  const rejectionRate = rejectedCount / recentCandidates.data.length;

  if (rejectionRate > 0.8 && recentCandidates.data.length > 5) {
    await flagScoutForReview(scoutId, 'æŽ¨èè´¨é‡è¿‡ä½Ž');
  }
}
```

---

### 5. æ•°æ®è®¿é—®æƒé™

#### ä¸­é—´ä»¶éªŒè¯

```javascript
// æƒé™æ£€æŸ¥ä¸­é—´ä»¶
async function checkPermission(openid, resource, action) {
  // 1. èŽ·å–ç”¨æˆ·è§’è‰²
  const user = await db.collection('users')
    .where({ openid })
    .get();

  if (user.data.length === 0) {
    throw new Error('ç”¨æˆ·ä¸å­˜åœ¨');
  }

  const { role_type, role_id } = user.data[0];

  // 2. æ£€æŸ¥èµ„æºè®¿é—®æƒé™
  const hasPermission = await checkRolePermission(
    role_type,
    resource,
    action,
    role_id
  );

  if (!hasPermission) {
    throw new Error('æ— æƒé™è®¿é—®è¯¥èµ„æº');
  }

  return true;
}

// ç¤ºä¾‹ï¼šç»çºªäººåªèƒ½æŸ¥çœ‹åä¸‹ä¸»æ’­çš„æ•°æ®
async function checkRolePermission(roleType, resource, action, roleId) {
  if (roleType === 'agent' && resource === 'streamer_data') {
    // éªŒè¯è¯¥ä¸»æ’­æ˜¯å¦å½’å±žäºŽè¯¥ç»çºªäºº
    const streamer = await db.collection('streamers')
      .where({
        _id: resourceId,
        agent_id: roleId
      })
      .count();

    return streamer.total > 0;
  }

  // å…¶ä»–è§’è‰²æƒé™è§„åˆ™...
}
```

---

## é™„å½•

### åœºæ™¯å€¼å¯¹ç…§è¡¨

| åœºæ™¯å€¼ | è¯´æ˜Ž | ç¤ºä¾‹ |
|--------|------|------|
| 1001 | å‘çŽ°æ å°ç¨‹åºä¸»å…¥å£ | - |
| 1011 | æ‰«æäºŒç»´ç  | æ˜ŸæŽ¢æŽ¨èç ã€å‘˜å·¥é‚€è¯·ç  |
| 1047 | æ‰«æå°ç¨‹åºç  | æ˜ŸæŽ¢æŽ¨èç ã€å‘˜å·¥é‚€è¯·ç  |
| 1089 | å¾®ä¿¡èŠå¤©ä¸»ç•Œé¢ä¸‹æ‹‰ | - |
| 1104 | èŠå¤©é™„ä»¶æ  | æ˜ŸæŽ¢åˆ†äº«é“¾æŽ¥ |

### ç›¸å…³æ–‡æ¡£

- [requirements.md](./requirements.md) - å®Œæ•´éœ€æ±‚æ–‡æ¡£
- [business-flow.md](./business-flow.md) - ä¸šåŠ¡æµç¨‹è¯¦è§£
- [roles-responsibilities.md](./roles-responsibilities.md) - è§’è‰²èŒè´£çŸ©é˜µ
- [data-flow.md](./data-flow.md) - æ•°æ®æµè½¬è®¾è®¡

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æœ€åŽæ›´æ–°**: 2025-11-02
**ç»´æŠ¤è€…**: äº§å“å›¢é˜Ÿ
**å®¡æ ¸çŠ¶æ€**: å·²å®¡æ ¸
